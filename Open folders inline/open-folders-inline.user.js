/*! For license information please see open-folders-inline.user.js.LICENSE.txt */
(()=>{"use strict";const e=e=>{if(!/^\d+\.\d+\.\d+$/.test(e))throw new Error(`Invalid version: ${e}.`);const[t,n,o]=e.split(".").map(Number);return[t,n,o]},t=(e,t)=>e-t,n=(e,n)=>t(e[0],n[0])||t(e[1],n[1])||t(e[2],n[2]),o="lastUpgraded";function r(){}function s(e){return e()}function i(){return Object.create(null)}function c(e){e.forEach(s)}function a(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let d;function u(e,t){return d||(d=document.createElement("a")),d.href=t,e===d.href}function f(e){return 0===Object.keys(e).length}new Set;let p=!1;function m(e,t){e.appendChild(t)}function h(e,t,n){e.insertBefore(t,n||null)}function g(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e){return document.createElement(e)}function w(e){return document.createTextNode(e)}function y(){return w(" ")}function v(){return w("")}function b(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function k(e){return function(t){return t.preventDefault(),e.call(this,t)}}function x(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function _(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function E(e,t){t=""+t,e.data!==t&&(e.data=t)}function C(e,t){e.value=null==t?"":t}function L(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function P(e,t,n){e.classList[n?"add":"remove"](t)}function M(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}new Map;let U;function S(e){U=e}function I(){if(!U)throw new Error("Function called outside component initialization");return U}function O(){const e=I();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const s=M(t,n,{cancelable:o});return r.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}const D=[],N=[];let R=[];const j=[],H=Promise.resolve();let G=!1;function T(){G||(G=!0,H.then(A))}function V(e){R.push(e)}const q=new Set;let z=0;function A(){if(0!==z)return;const e=U;do{try{for(;z<D.length;){const e=D[z];z++,S(e),B(e.$$)}}catch(e){throw D.length=0,z=0,e}for(S(null),D.length=0,z=0;N.length;)N.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];q.has(t)||(q.add(t),t())}R.length=0}while(D.length);for(;j.length;)j.pop()();G=!1,q.clear(),S(e)}function B(e){if(null!==e.fragment){e.update(),c(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(V)}}const F=new Set;let K;function W(){K={r:0,c:[],p:K}}function J(){K.r||c(K.c),K=K.p}function Q(e,t){e&&e.i&&(F.delete(e),e.i(t))}function X(e,t,n,o){if(e&&e.o){if(F.has(e))return;F.add(e),K.c.push((()=>{F.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Y(e,t){e.d(1),t.delete(e.key)}function Z(e,t){X(e,1,1,(()=>{t.delete(e.key)}))}function ee(e,t,n,o,r,s,i,a,l,d,u,f){let p=e.length,m=s.length,h=p;const g={};for(;h--;)g[e[h].key]=h;const $=[],w=new Map,y=new Map,v=[];for(h=m;h--;){const e=f(r,s,h),c=n(e);let a=i.get(c);a?o&&v.push((()=>a.p(e,t))):(a=d(c,e),a.c()),w.set(c,$[h]=a),c in g&&y.set(c,Math.abs(h-g[c]))}const b=new Set,k=new Set;function x(e){Q(e,1),e.m(a,u),i.set(e.key,e),u=e.first,m--}for(;p&&m;){const t=$[m-1],n=e[p-1],o=t.key,r=n.key;t===n?(u=t.first,p--,m--):w.has(r)?!i.has(o)||b.has(o)?x(t):k.has(r)?p--:y.get(o)>y.get(r)?(k.add(o),x(t)):(b.add(r),p--):(l(n,i),p--)}for(;p--;){const t=e[p];w.has(t.key)||l(t,i)}for(;m;)x($[m-1]);return c(v),$}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let te;function ne(e){e&&e.c()}function oe(e,t,n,o){const{fragment:r,after_update:i}=e.$$;r&&r.m(t,n),o||V((()=>{const t=e.$$.on_mount.map(s).filter(a);e.$$.on_destroy?e.$$.on_destroy.push(...t):c(t),e.$$.on_mount=[]})),i.forEach(V)}function re(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];R.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),R=t}(n.after_update),c(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function se(e,t,n,o,s,a,l,d=[-1]){const u=U;S(e);const f=e.$$={fragment:null,ctx:[],props:a,update:r,not_equal:s,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:i(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};l&&l(f.root);let m=!1;if(f.ctx=n?n(e,t.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&s(f.ctx[t],f.ctx[t]=r)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](r),m&&function(e,t){-1===e.$$.dirty[0]&&(D.push(e),T(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],f.update(),m=!0,c(f.before_update),f.fragment=!!o&&o(f.ctx),t.target){if(t.hydrate){p=!0;const e=(h=t.target,Array.from(h.childNodes));f.fragment&&f.fragment.l(e),e.forEach(g)}else f.fragment&&f.fragment.c();t.intro&&Q(e.$$.fragment),oe(e,t.target,t.anchor,t.customElement),p=!1,A()}var h;S(u)}"function"==typeof HTMLElement&&(te=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(s).filter(a);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){c(this.$$.on_disconnect)}$destroy(){re(this,1),this.$destroy=r}$on(e,t){if(!a(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!f(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class ie{$destroy(){re(this,1),this.$destroy=r}$on(e,t){if(!a(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!f(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ce=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0});function ae(e){const t=new URL(e);return"1"===t.searchParams.get("forcedownload")&&t.searchParams.set("forcedownload","0"),t.href}function le(e,t){function n(){t.append(e)}return n(),{update:n,destroy:function(){e.remove()}}}function de(e){let t,n,o,s;return{c(){t=$("span"),t.innerHTML='<svg fill="currentColor" aria-hidden="true" class="icon navicon svg-refresh" viewBox="0 0 512 512"><path d="M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"></path></svg>',_(t,"class","svg-refresh-hitbox"),L(t,"margin-left","5px")},m(i,c){var l;h(i,t,c),o||(s=[(l=n=le.call(null,t,e[0]),l&&a(l.destroy)?l.destroy:r),b(t,"click",x(k(e[1]))),b(t,"keydown",e[2])],o=!0)},p(e,[t]){n&&a(n.update)&&1&t&&n.update.call(null,e[0])},i:r,o:r,d(e){e&&g(t),o=!1,c(s)}}}function ue(e,t,n){let{target:o}=t;const r=O();function s(){r("click")}return e.$$set=e=>{"target"in e&&n(0,o=e.target)},[o,s,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),s())}]}const fe=class extends ie{constructor(e){super(),se(this,e,ue,de,l,{target:0})}},pe=new Map;function me(e){const t=Symbol(e.name);return function(...n){const o=n.slice(0,-1),r=[this,...o],s=n.at(-1),i=function(e){let t=pe;for(const n of e)t.has(n)||t.set(n,new Map),t=t.get(n);return t}(r);if(s&&i.has(t))return i.get(t);const c=e.apply(this,o);return i.set(t,c),c instanceof Promise&&c.catch((()=>{i.delete(t)})),c}}async function he(e){return await this.fetch("core_course_get_contents",{courseid:String(e),"options[0][name]":"includestealthmodules","options[0][value]":"1"})}var ge;!function(e){e.username="username",e.token="token"}(ge||(ge={}));const $e=e=>[()=>GM_getValue(e),t=>{GM_setValue(e,t)},()=>{GM_deleteValue(e)}],[we,ye,ve]=$e(ge.token),[be,ke,xe]=$e(ge.username);class _e extends Error{constructor(){super("No credentials provided.")}}class Ee extends Error{constructor(){super("Invalid credentials.")}}class Ce extends Error{constructor(e){super(`${e} not included`)}}let Le=new URL("http://localhost/");"undefined"!=typeof location?Le=new URL("/",location.href):"undefined"!=typeof process&&"string"==typeof process.env.MOODLE_BASE_URL&&(Le=new URL(process.env.MOODLE_BASE_URL));class Pe{static extend(e){return e(Pe),Pe}baseUrl=Le;credentials={token:we(),username:be()};resolveUrl=e=>new URL(e,this.baseUrl);async login(e){const{credentials:t}=this;if(e&&(t.username=e.username,t.password=e.password,ke(e.username)),t.token)return t.token;const{username:n,password:o}=t;if(!n||!o)throw new _e;const r=new URLSearchParams({username:n,password:o,service:"moodle_mobile_app"}),s=await fetch(this.resolveUrl("/login/token.php"),{method:"POST",body:r.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}});if(!s.ok)throw new Error(`Response was not ok: ${s.status}`);const i=await s.json();if("errorcode"in i)throw this.logout(),new Ee;const{token:c}=i;return ye(c),t.token=c,c}async fetch(e,t){const n=new URLSearchParams(t);n.set("wstoken",await this.login()),n.set("wsfunction",e),n.set("moodlewsrestformat","json");const o=await fetch(this.resolveUrl("/webservice/rest/server.php"),{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:n.toString()});if(!o.ok)throw new Error(`Response was not ok: ${o.status}`);const r=await o.json(),s=r;if("exception"in s)throw this.logout(),new Error(`Error(${s.exception}): ${s.message}`);return r}logout(){delete this.credentials.token,ve(),delete this.credentials.password}async getCourses(e){throw new Ce("getCourses")}async getUserId(e){throw new Ce("getUserId")}async popupLogin(e,t){throw new Ce("popupLogin")}async getCourseContent(e,t){throw new Ce("getCourseContent")}}function Me(e){let t,n,o,r,s,i,a,l,d,u,f,p,v,L,M,U,S,I,O,D,N;return{c(){t=$("div"),n=$("form"),o=$("div"),r=$("div"),s=$("h5"),i=w("Login - "),a=w(e[0]),l=y(),d=$("div"),u=$("label"),u.textContent="Username",f=y(),p=$("input"),v=y(),L=$("div"),M=$("label"),M.textContent="Password",U=y(),S=$("input"),I=y(),O=$("button"),O.textContent="Login",_(s,"class","card-title"),_(u,"for","popup-username"),_(u,"class","form-label"),p.required=!0,_(p,"id","popup-username"),_(p,"placeholder","Username"),_(p,"class","form-control"),P(p,"is-invalid",""===e[2].trim()),_(d,"class","mb-3"),_(M,"for","popup-password"),_(M,"class","form-label"),S.required=!0,_(S,"id","popup-password"),_(S,"placeholder","Password"),_(S,"class","form-control"),_(S,"type","password"),P(S,"is-invalid",""===e[3]),_(L,"class","mb-3"),_(r,"class","card-body"),_(O,"class","btn btn-primary"),_(O,"type","submit"),_(o,"class","card shadow"),_(t,"class","vertical-horizontal-center")},m(c,g){h(c,t,g),m(t,n),m(n,o),m(o,r),m(r,s),m(s,i),m(s,a),m(r,l),m(r,d),m(d,u),m(d,f),m(d,p),C(p,e[2]),m(r,v),m(r,L),m(L,M),m(L,U),m(L,S),C(S,e[3]),m(o,I),m(o,O),D||(N=[b(p,"input",e[6]),b(S,"input",e[7]),b(n,"submit",x(k(e[4])))],D=!0)},p(e,t){1&t&&E(a,e[0]),4&t&&p.value!==e[2]&&C(p,e[2]),4&t&&P(p,"is-invalid",""===e[2].trim()),8&t&&S.value!==e[3]&&C(S,e[3]),8&t&&P(S,"is-invalid",""===e[3])},d(e){e&&g(t),D=!1,c(N)}}}function Ue(e){let t,n=e[1]&&Me(e);return{c(){n&&n.c(),t=v()},m(e,o){n&&n.m(e,o),h(e,t,o)},p(e,[o]){e[1]?n?n.p(e,o):(n=Me(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:r,o:r,d(e){n&&n.d(e),e&&g(t)}}}function Se(e,t,n){let{title:o}=t,{moodle:r}=t;const s=O();let i=!0,c=be()??"",a="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"moodle"in e&&n(5,r=e.moodle)},[o,i,c,a,async function(){if(n(2,c=c.trim()),c&&a){n(1,i=!1);try{const e=await r.login({username:c,password:a});s("login",e)}catch{n(1,i=!0)}}},r,function(){c=this.value,n(2,c)},function(){a=this.value,n(3,a)}]}const Ie=class extends ie{constructor(e){super(),se(this,e,Se,Ue,l,{title:0,moodle:5})}};async function Oe(e){return new Promise((t=>{const n=GM_addStyle(".login-popup-userscript .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.login-popup-userscript .card{pointer-events:auto}"),o=document.createElement("div");o.className="login-popup-userscript",document.body.append(o);const r=new Ie({target:o,props:{title:e,moodle:this}});r.$on("login",(({detail:e})=>{r.$destroy(),n.remove(),o.remove(),t(e)}))}))}const De={"application/pdf":"pdf-256","application/zip":"archive-256","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"document-256","application/msword":"document-256","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"spreadsheet-256","application/vnd.ms-excel":"spreadsheet-256","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint-256","application/vnd.ms-powerpoint":"powerpoint-256","text/plain":"sourcecode-256","audio/mp3":"mp3-256","audio/mp4":"mp3-256","video/quicktime":"quicktime-256","video/mp4":"mpeg-256"},Ne=(e,t)=>{const n=De[e];return n?`/theme/image.php/classic/core/1601902087/f/${n}`:t};Pe.extend((e=>{e.prototype.popupLogin=me(Oe)})).extend((e=>{e.prototype.getCourseContent=me(he)}));const Re=new Pe,je=async e=>{const t=new URLSearchParams(location.search),n=t.get("id");if(!n)return console.error('Could not extract courseId "%s"',t),!1;try{return await Re.fetch("core_course_get_contents",{courseid:n,"options[0][name]":"sectionid","options[0][value]":e,"options[1][name]":"modname","options[1][value]":"folder"})}catch{return await Re.popupLogin("Open folders inline",!0),je(e)}},He=me((async(e,t)=>{const n=await je(e);if(!1===n)return!1;const o=n.find((({id:t})=>t===Number(e)));if(!o)return console.error("Could not find sectionObject."),!1;const{modules:r}=o,s=r.find((({id:e,modname:n})=>"folder"===n&&e===Number(t)));if(!s)return console.error("Could not find folderObject."),!1;const{contents:i}=s,c=[];for(const e of i)if("file"===e.type){const{filepath:t,mimetype:n}=e,o=Re.resolveUrl(e.fileurl);o.pathname=o.pathname.replace(/^\/webservice/,"");const r=new URL(o.href);n?.startsWith("image")||r.searchParams.set("preview","1"),c.push({...e,filePath:(a=t,a.trim().split(/\/+/).filter(Boolean)),imgPath:Ne(n,r.href),fileUrl:o.href})}var a;return c}));function Ge(e){let t,n,o,s,i,a,l,d,f,p,v;return{c(){t=$("div"),n=$("div"),o=$("i"),s=y(),i=$("img"),l=y(),d=$("span"),f=w(e[1]),_(o,"class","icon fa fa-fw navicon folders-inline-caret"),P(o,"fa-caret-right",e[0]),P(o,"fa-caret-down",!e[0]),_(i,"alt",""),_(i,"class","iconlarge activityicon"),_(i,"role","presentation"),_(i,"title",e[1]),_(i,"aria-hidden","true"),u(i.src,a="/theme/image.php/classic/core/1601902087/f/folder-128")||_(i,"src","/theme/image.php/classic/core/1601902087/f/folder-128"),_(n,"class","folders-inline-icon-div"),_(d,"class","fp-filename"),_(t,"class","fp-filename-icon folders-inline-icon")},m(r,c){h(r,t,c),m(t,n),m(n,o),m(n,s),m(n,i),m(t,l),m(t,d),m(d,f),p||(v=[b(t,"click",x(k(e[2]))),b(t,"keydown",e[3])],p=!0)},p(e,[t]){1&t&&P(o,"fa-caret-right",e[0]),1&t&&P(o,"fa-caret-down",!e[0]),2&t&&_(i,"title",e[1]),2&t&&E(f,e[1])},i:r,o:r,d(e){e&&g(t),p=!1,c(v)}}}function Te(e,t,n){let{isHidden:o}=t,{base:r}=t;const s=O();function i(){s("click")}return e.$$set=e=>{"isHidden"in e&&n(0,o=e.isHidden),"base"in e&&n(1,r=e.base)},[o,r,i,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),i())}]}const Ve=class extends ie{constructor(e){super(),se(this,e,Te,Ge,l,{isHidden:0,base:1})}};function qe(e,t,n){const o=e.slice();return o[9]=t[n].fileUrl,o[10]=t[n].filename,o[11]=t[n].imgPath,o}function ze(e,t,n){const o=e.slice();return o[14]=t[n][0],o[15]=t[n][1],o}function Ae(e){let t,n;return t=new Ve({props:{isHidden:e[3],base:e[1]}}),t.$on("click",e[7]),{c(){ne(t.$$.fragment)},m(e,o){oe(t,e,o),n=!0},p(e,n){const o={};8&n&&(o.isHidden=e[3]),2&n&&(o.base=e[1]),t.$set(o)},i(e){n||(Q(t.$$.fragment,e),n=!0)},o(e){X(t.$$.fragment,e),n=!1},d(e){re(t,e)}}}function Be(e){let t,n,o,r=[],s=new Map,i=[],c=new Map,a=e[4];const l=e=>e[14];for(let t=0;t<a.length;t+=1){let n=ze(e,a,t),o=l(n);s.set(o,r[t]=Fe(o,n))}let d=e[5]??[];const u=e=>e[10];for(let t=0;t<d.length;t+=1){let n=qe(e,d,t),o=u(n);c.set(o,i[t]=Ke(o,n))}return{c(){t=$("ul");for(let e=0;e<r.length;e+=1)r[e].c();n=y();for(let e=0;e<i.length;e+=1)i[e].c();L(t,"list-style","none")},m(e,s){h(e,t,s);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null);m(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);o=!0},p(e,o){17&o&&(a=e[4],W(),r=ee(r,o,l,1,e,a,s,t,Z,Fe,n,ze),J()),32&o&&(d=e[5]??[],i=ee(i,o,u,1,e,d,c,t,Y,Ke,null,qe))},i(e){if(!o){for(let e=0;e<a.length;e+=1)Q(r[e]);o=!0}},o(e){for(let e=0;e<r.length;e+=1)X(r[e]);o=!1},d(e){e&&g(t);for(let e=0;e<r.length;e+=1)r[e].d();for(let e=0;e<i.length;e+=1)i[e].d()}}}function Fe(e,t){let n,o,r;return o=new Qe({props:{contents:t[15],base:t[14],directoryDepth:t[0]+1}}),{key:e,first:null,c(){n=$("li"),ne(o.$$.fragment),this.first=n},m(e,t){h(e,n,t),oe(o,n,null),r=!0},p(e,n){t=e;const r={};16&n&&(r.contents=t[15]),16&n&&(r.base=t[14]),1&n&&(r.directoryDepth=t[0]+1),o.$set(r)},i(e){r||(Q(o.$$.fragment,e),r=!0)},o(e){X(o.$$.fragment,e),r=!1},d(e){e&&g(n),re(o)}}}function Ke(e,t){let n,o,r,s,i,c,a,l,d,f,p,v,b=t[10]+"";return{key:e,first:null,c(){n=$("li"),o=$("span"),r=$("a"),s=$("span"),i=$("img"),l=y(),d=$("span"),f=w(b),v=y(),_(i,"alt",""),_(i,"title",c=t[10]),u(i.src,a=t[11])||_(i,"src",a),_(s,"class","fp-icon"),_(d,"class","fp-filename"),_(r,"href",p=ae(t[9])),_(o,"class","fp-filename-icon"),this.first=n},m(e,t){h(e,n,t),m(n,o),m(o,r),m(r,s),m(s,i),m(r,l),m(r,d),m(d,f),m(n,v)},p(e,n){t=e,32&n&&c!==(c=t[10])&&_(i,"title",c),32&n&&!u(i.src,a=t[11])&&_(i,"src",a),32&n&&b!==(b=t[10]+"")&&E(f,b),32&n&&p!==(p=ae(t[9]))&&_(r,"href",p)},d(e){e&&g(n)}}}function We(e){let t,n,o,r=!e[2]&&Ae(e),s=!e[6]&&Be(e);return{c(){r&&r.c(),t=y(),s&&s.c(),n=v()},m(e,i){r&&r.m(e,i),h(e,t,i),s&&s.m(e,i),h(e,n,i),o=!0},p(e,[o]){e[2]?r&&(W(),X(r,1,1,(()=>{r=null})),J()):r?(r.p(e,o),4&o&&Q(r,1)):(r=Ae(e),r.c(),Q(r,1),r.m(t.parentNode,t)),e[6]?s&&(W(),X(s,1,1,(()=>{s=null})),J()):s?(s.p(e,o),64&o&&Q(s,1)):(s=Be(e),s.c(),Q(s,1),s.m(n.parentNode,n))},i(e){o||(Q(r),Q(s),o=!0)},o(e){X(r),X(s),o=!1},d(e){r&&r.d(e),e&&g(t),s&&s.d(e),e&&g(n)}}}function Je(e,t,n){let o,r,s,{contents:i}=t,{directoryDepth:c}=t,{base:a}=t,{isParent:l}=t,d=!l;return e.$$set=e=>{"contents"in e&&n(8,i=e.contents),"directoryDepth"in e&&n(0,c=e.directoryDepth),"base"in e&&n(1,a=e.base),"isParent"in e&&n(2,l=e.isParent)},e.$$.update=()=>{12&e.$$.dirty&&n(6,o=d&&!l),257&e.$$.dirty&&n(5,({root:r,entries:s}=function(e,t){const n={};for(const o of e)if("isexternalfile"in o){const e=o.filePath[t]??"/";(n[e]??(n[e]=[])).push(o)}const o=n["/"];o?.sort(((e,t)=>ce.compare(e.filename.trim(),t.filename.trim()))),delete n["/"];const r=Object.entries(n);return r.sort((([e],[t])=>ce.compare(e.trim(),t.trim()))),{root:o,entries:r}}(i,c)),r,(n(4,s),n(8,i),n(0,c)))},[c,a,l,d,s,r,o,function(){n(3,d=!d)},i]}class Qe extends ie{constructor(e){super(),se(this,e,Je,We,l,{contents:8,directoryDepth:0,base:1,isParent:2})}}const Xe=Qe;function Ye(e){let t,n,o,r,s;const i=[tt,et,Ze],c=[];function a(e,t){return e[1]?0===e[1].length?1:2:0}return t=a(e),n=c[t]=i[t](e),r=new fe({props:{target:e[0]}}),r.$on("click",e[7]),{c(){n.c(),o=y(),ne(r.$$.fragment)},m(e,n){c[t].m(e,n),h(e,o,n),oe(r,e,n),s=!0},p(e,s){let l=t;t=a(e),t===l?c[t].p(e,s):(W(),X(c[l],1,1,(()=>{c[l]=null})),J(),n=c[t],n?n.p(e,s):(n=c[t]=i[t](e),n.c()),Q(n,1),n.m(o.parentNode,o));const d={};1&s&&(d.target=e[0]),r.$set(d)},i(e){s||(Q(n),Q(r.$$.fragment,e),s=!0)},o(e){X(n),X(r.$$.fragment,e),s=!1},d(e){c[t].d(e),e&&g(o),re(r,e)}}}function Ze(e){let t,n;return t=new Xe({props:{directoryDepth:0,isParent:!0,contents:e[1]}}),{c(){ne(t.$$.fragment)},m(e,o){oe(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.contents=e[1]),t.$set(o)},i(e){n||(Q(t.$$.fragment,e),n=!0)},o(e){X(t.$$.fragment,e),n=!1},d(e){re(t,e)}}}function et(e){let t;return{c(){t=$("div"),t.textContent="The folder was empty",_(t,"class","folder-empty")},m(e,n){h(e,t,n)},p:r,i:r,o:r,d(e){e&&g(t)}}}function tt(e){let t;return{c(){t=$("div"),t.textContent="Loading",_(t,"class","folder-loading")},m(e,n){h(e,t,n)},p:r,i:r,o:r,d(e){e&&g(t)}}}function nt(e){let t,n,o=!e[2]&&Ye(e);return{c(){o&&o.c(),t=v()},m(e,r){o&&o.m(e,r),h(e,t,r),n=!0},p(e,[n]){e[2]?o&&(W(),X(o,1,1,(()=>{o=null})),J()):o?(o.p(e,n),4&n&&Q(o,1)):(o=Ye(e),o.c(),Q(o,1),o.m(t.parentNode,t))},i(e){n||(Q(o),n=!0)},o(e){X(o),n=!1},d(e){o&&o.d(e),e&&g(t)}}}function ot(e,t,n){let o,{folderId:r}=t,{sectionId:s}=t,{anchor:i}=t,c=!1;var a;let l;async function d(e){n(1,o=void 0);const t=await He(s,r,e);t&&n(1,o=t)}function u(e){e.ctrlKey||(e.preventDefault(),e.stopImmediatePropagation(),n(2,c=!c))}a=()=>{d(!0)},I().$$.on_mount.push(a);return e.$$set=e=>{"folderId"in e&&n(4,r=e.folderId),"sectionId"in e&&n(5,s=e.sectionId),"anchor"in e&&n(0,i=e.anchor)},e.$$.update=()=>{65&e.$$.dirty&&(l!==i&&l?.removeEventListener("click",u),n(6,l=i),i.addEventListener("click",u))},[i,o,c,d,r,s,l,()=>{d(!1)}]}const rt=class extends ie{constructor(e){super(),se(this,e,ot,nt,l,{folderId:4,sectionId:5,anchor:0})}};function st(e){if(e.ctrlKey)return;if(!(e.target instanceof Element))return;const t=e.target.closest("a");if("/mod/folder/view.php"!==t?.pathname)return;const n=t.closest("li.activity.folder");if(!n)return;const o=/\d+$/.exec(n.id)?.[0];if(!o)return void console.error("Could not get folderId.");const r=t.closest("li.section.main"),s=r?.getAttribute("aria-labelledby")?.match(/-(\d+)-/)?.[1];if(!s)return void console.error("sectionId was undefined.");e.preventDefault();const i=document.createElement("span");i.className="folder-parent",new rt({target:i,props:{sectionId:s,folderId:o,anchor:t}}),n.append(i)}var it;
// ==UserScript==
// @name      Moodle Open Folders Inline
// @version   5.0.0
// @author    lusc
// @match     *://moodle.*/course/view.php?id=*
// @match     *://moodle*.*/course/view.php?id=*
// @updateURL https://github.com/melusc/moodle_userscripts/raw/userscript-out/Open%20folders%20inline/open-folders-inline.user.js
// @grant     GM_setValue
// @grant     GM_getValue
// @grant     GM_deleteValue
// @grant     GM_addStyle
// @run-at    document-start
// @license   MIT
// ==/UserScript==
(t=>{try{(t=>{const r=GM_getValue(o),s=void 0===r?[-1,-1,-1]:e(r),i=Object.entries(t).map((([t,n])=>[e(t),n])).sort((([e],[t])=>n(e,t)));for(const[e,t]of i)n(s,e)<0&&t();GM_setValue(o,GM_info.script.version)})(t)}catch(e){console.error("Upgrading threw %o. Failing silently.",e)}})({"1.2.0":()=>{GM_deleteValue("lastValidatedToken"),GM_deleteValue("password")}}),GM_addStyle('@keyframes folder-loading-dots{0%{content:""}33%{content:"."}67%{content:".."}to{content:"..."}}div.folders-inline-icon{cursor:pointer;user-select:none}div.folders-inline-icon-div{display:inline}.folder-parent li{margin-left:24px;padding-left:none}.folder-empty,.folder-loading{margin-left:calc(1rem + 24px)}.folder-loading::after{content:"";animation:folder-loading-dots .6s infinite linear alternate}'),it=function(){document.querySelector("div.course-content > ul")?.addEventListener("click",st)},"interactive"!==document.readyState&&"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",it,{once:!0}):it()})();