/*! For license information please see open-folders-inline.user.js.LICENSE.txt */
(()=>{"use strict";const e=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),t=e=>{if(!/^\d+\.\d+\.\d+$/.test(e))throw new Error(`Invalid version: ${e}.`);const[t,n,o]=e.split(".").map(Number);return[t,n,o]},n=(e,t)=>e-t,o=(e,t)=>n(e[0],t[0])||n(e[1],t[1])||n(e[2],t[2]),r="lastUpgraded";function s(){}function i(e){return e()}function c(){return Object.create(null)}function a(e){e.forEach(i)}function l(e){return"function"==typeof e}function d(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let u;function f(e,t){return u||(u=document.createElement("a")),u.href=t,e===u.href}function p(e){return 0===Object.keys(e).length}new Set;let m=!1;function h(e,t){e.appendChild(t)}function g(e,t,n){e.insertBefore(t,n||null)}function $(e){e.parentNode&&e.parentNode.removeChild(e)}function w(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function v(){return y(" ")}function b(){return y("")}function k(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function x(e){return function(t){return t.preventDefault(),e.call(this,t)}}function _(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function C(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function E(e,t){t=""+t,e.data!==t&&(e.data=t)}function L(e,t){e.value=null==t?"":t}function P(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function M(e,t,n){e.classList[n?"add":"remove"](t)}function U(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}new Map;let S;function I(e){S=e}function O(){if(!S)throw new Error("Function called outside component initialization");return S}function D(){const e=O();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const s=U(t,n,{cancelable:o});return r.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}const N=[],R=[];let j=[];const H=[],G=Promise.resolve();let T=!1;function V(){T||(T=!0,G.then(B))}function q(e){j.push(e)}const z=new Set;let A=0;function B(){if(0!==A)return;const e=S;do{try{for(;A<N.length;){const e=N[A];A++,I(e),F(e.$$)}}catch(e){throw N.length=0,A=0,e}for(I(null),N.length=0,A=0;R.length;)R.pop()();for(let e=0;e<j.length;e+=1){const t=j[e];z.has(t)||(z.add(t),t())}j.length=0}while(N.length);for(;H.length;)H.pop()();T=!1,z.clear(),I(e)}function F(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(q)}}const K=new Set;let W;function J(){W={r:0,c:[],p:W}}function Q(){W.r||a(W.c),W=W.p}function X(e,t){e&&e.i&&(K.delete(e),e.i(t))}function Y(e,t,n,o){if(e&&e.o){if(K.has(e))return;K.add(e),W.c.push((()=>{K.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Z(e,t){e.d(1),t.delete(e.key)}function ee(e,t){Y(e,1,1,(()=>{t.delete(e.key)}))}function te(e,t,n,o,r,s,i,c,l,d,u,f){let p=e.length,m=s.length,h=p;const g={};for(;h--;)g[e[h].key]=h;const $=[],w=new Map,y=new Map,v=[];for(h=m;h--;){const e=f(r,s,h),c=n(e);let a=i.get(c);a?o&&v.push((()=>a.p(e,t))):(a=d(c,e),a.c()),w.set(c,$[h]=a),c in g&&y.set(c,Math.abs(h-g[c]))}const b=new Set,k=new Set;function x(e){X(e,1),e.m(c,u),i.set(e.key,e),u=e.first,m--}for(;p&&m;){const t=$[m-1],n=e[p-1],o=t.key,r=n.key;t===n?(u=t.first,p--,m--):w.has(r)?!i.has(o)||b.has(o)?x(t):k.has(r)?p--:y.get(o)>y.get(r)?(k.add(o),x(t)):(b.add(r),p--):(l(n,i),p--)}for(;p--;){const t=e[p];w.has(t.key)||l(t,i)}for(;m;)x($[m-1]);return a(v),$}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let ne;function oe(e){e&&e.c()}function re(e,t,n,o){const{fragment:r,after_update:s}=e.$$;r&&r.m(t,n),o||q((()=>{const t=e.$$.on_mount.map(i).filter(l);e.$$.on_destroy?e.$$.on_destroy.push(...t):a(t),e.$$.on_mount=[]})),s.forEach(q)}function se(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];j.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),j=t}(n.after_update),a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ie(e,t,n,o,r,i,l,d=[-1]){const u=S;I(e);const f=e.$$={fragment:null,ctx:[],props:i,update:s,not_equal:r,bound:c(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:c(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};l&&l(f.root);let p=!1;if(f.ctx=n?n(e,t.props||{},((t,n,...o)=>{const s=o.length?o[0]:n;return f.ctx&&r(f.ctx[t],f.ctx[t]=s)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](s),p&&function(e,t){-1===e.$$.dirty[0]&&(N.push(e),V(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],f.update(),p=!0,a(f.before_update),f.fragment=!!o&&o(f.ctx),t.target){if(t.hydrate){m=!0;const e=(h=t.target,Array.from(h.childNodes));f.fragment&&f.fragment.l(e),e.forEach($)}else f.fragment&&f.fragment.c();t.intro&&X(e.$$.fragment),re(e,t.target,t.anchor,t.customElement),m=!1,B()}var h;I(u)}"function"==typeof HTMLElement&&(ne=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(i).filter(l);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){a(this.$$.on_disconnect)}$destroy(){se(this,1),this.$destroy=s}$on(e,t){if(!l(t))return s;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!p(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class ce{$destroy(){se(this,1),this.$destroy=s}$on(e,t){if(!l(t))return s;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!p(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function ae(e){const t=new URL(e);return"1"===t.searchParams.get("forcedownload")&&t.searchParams.set("forcedownload","0"),t.href}function le(e,t){function n(){t.append(e)}return n(),{update:n,destroy:function(){e.remove()}}}function de(e){let t,n,o,r;return{c(){t=w("span"),t.innerHTML='<svg fill="currentColor" aria-hidden="true" class="icon navicon svg-refresh" viewBox="0 0 512 512"><path d="M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"></path></svg>',C(t,"class","svg-refresh-hitbox"),P(t,"margin-left","5px")},m(i,c){var a;g(i,t,c),o||(r=[(a=n=le.call(null,t,e[0]),a&&l(a.destroy)?a.destroy:s),k(t,"click",_(x(e[1]))),k(t,"keydown",e[2])],o=!0)},p(e,[t]){n&&l(n.update)&&1&t&&n.update.call(null,e[0])},i:s,o:s,d(e){e&&$(t),o=!1,a(r)}}}function ue(e,t,n){let{target:o}=t;const r=D();function s(){r("click")}return e.$$set=e=>{"target"in e&&n(0,o=e.target)},[o,s,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),s())}]}const fe=class extends ce{constructor(e){super(),ie(this,e,ue,de,d,{target:0})}};var pe;!function(e){e.username="username",e.token="token"}(pe||(pe={}));const me=e=>[()=>GM_getValue(e),t=>{GM_setValue(e,t)},()=>{GM_deleteValue(e)}],[he,ge,$e]=me(pe.token),[we,ye,ve]=me(pe.username),be=Symbol("getCourseContent");async function ke(e,t=!1){e=String(e);const n=this._readCache(be)??{},o=n[e];if(o&&!t)return o;const r=await this.login(),s=new URLSearchParams({courseid:e,"options[0][name]":"includestealthmodules","options[0][value]":"1",moodlewsrestformat:"json",wsfunction:"core_course_get_contents",wstoken:r}),i=await fetch(this.resolveUrl("/webservice/rest/server.php"),{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:s.toString()});if(!i.ok)throw new Error(`Response was not ok: ${i.status}`);const c=await i.json();if("exception"in c)throw this.logout(),new Error("Invalid token");return n[e]=c,this._writeCache(be,n),c}Symbol("getUserId");Symbol("getCourses");class xe extends Error{constructor(){super("No credentials provided.")}}class _e extends Error{constructor(){super("Invalid credentials.")}}class Ce extends Error{constructor(e){super(`${e} not included`)}}let Ee=new URL("http://localhost/");"undefined"!=typeof location?Ee=new URL("/",location.href):"undefined"!=typeof process&&"string"==typeof process.env.MOODLE_BASE_URL&&(Ee=new URL(process.env.MOODLE_BASE_URL));class Le{static extend(e){return e(Le),Le}baseUrl=Ee;credentials={token:he(),username:we()};#e=new Map;resolveUrl=e=>new URL(e,this.baseUrl);_readCache(e){return this.#e.get(e)}_writeCache(e,t){return this.#e.set(e,t),t}async login(e){const{credentials:t}=this;if(e&&(t.username=e.username,t.password=e.password,ye(e.username)),t.token)return t.token;const{username:n,password:o}=t;if(!n||!o)throw new xe;const r=new URLSearchParams({username:n,password:o,service:"moodle_mobile_app"}),s=await fetch(this.resolveUrl("/login/token.php"),{method:"POST",body:r.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}});if(!s.ok)throw new Error(`Response was not ok: ${s.status}`);const i=await s.json();if("errorcode"in i)throw this.logout(),new _e;const{token:c}=i;return ge(c),t.token=c,c}logout(){delete this.credentials.token,$e(),delete this.credentials.password}async getCourses(e){throw new Ce("getCourses")}async getUserId(){throw new Ce("getUserId")}async popupLogin(e){throw new Ce("popupLogin")}async getCourseContent(e,t){throw new Ce("getCourseContent")}}function Pe(e){let t,n,o,r,s,i,c,l,d,u,f,p,m,b,P,U,S,I,O,D,N;return{c(){t=w("div"),n=w("form"),o=w("div"),r=w("div"),s=w("h5"),i=y("Login - "),c=y(e[0]),l=v(),d=w("div"),u=w("label"),u.textContent="Username",f=v(),p=w("input"),m=v(),b=w("div"),P=w("label"),P.textContent="Password",U=v(),S=w("input"),I=v(),O=w("button"),O.textContent="Login",C(s,"class","card-title"),C(u,"for","popup-username"),C(u,"class","form-label"),p.required=!0,C(p,"id","popup-username"),C(p,"placeholder","Username"),C(p,"class","form-control"),M(p,"is-invalid",""===e[2].trim()),C(d,"class","mb-3"),C(P,"for","popup-password"),C(P,"class","form-label"),S.required=!0,C(S,"id","popup-password"),C(S,"placeholder","Password"),C(S,"class","form-control"),C(S,"type","password"),M(S,"is-invalid",""===e[3]),C(b,"class","mb-3"),C(r,"class","card-body"),C(O,"class","btn btn-primary"),C(O,"type","submit"),C(o,"class","card shadow"),C(t,"class","vertical-horizontal-center")},m(a,$){g(a,t,$),h(t,n),h(n,o),h(o,r),h(r,s),h(s,i),h(s,c),h(r,l),h(r,d),h(d,u),h(d,f),h(d,p),h(r,m),h(r,b),h(b,P),h(b,U),h(b,S),L(S,e[3]),h(o,I),h(o,O),D||(N=[k(S,"input",e[6]),k(n,"submit",_(x(e[4])))],D=!0)},p(e,t){1&t&&E(c,e[0]),4&t&&M(p,"is-invalid",""===e[2].trim()),8&t&&S.value!==e[3]&&L(S,e[3]),8&t&&M(S,"is-invalid",""===e[3])},d(e){e&&$(t),D=!1,a(N)}}}function Me(e){let t,n=e[1]&&Pe(e);return{c(){n&&n.c(),t=b()},m(e,o){n&&n.m(e,o),g(e,t,o)},p(e,[o]){e[1]?n?n.p(e,o):(n=Pe(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:s,o:s,d(e){n&&n.d(e),e&&$(t)}}}function Ue(e,t,n){let{title:o}=t,{moodle:r}=t;const s=D();let i=!0,c=we()??"",a="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"moodle"in e&&n(5,r=e.moodle)},[o,i,c,a,async function(){if(n(2,c=c.trim()),c&&a){n(1,i=!1);try{const e=await r.login({username:c,password:a});s("login",e)}catch{n(1,i=!0)}}},r,function(){a=this.value,n(3,a)}]}const Se=class extends ce{constructor(e){super(),ie(this,e,Ue,Me,d,{title:0,moodle:5})}};async function Ie(e){return console.trace(this,e),new Promise((t=>{const n=GM_addStyle(".login-popup-userscript .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.login-popup-userscript .card{pointer-events:auto}"),o=document.createElement("div");o.className="login-popup-userscript",document.body.append(o);const r=new Se({target:o,props:{title:e,moodle:this}});r.$on("login",(({detail:e})=>{r.$destroy(),n.remove(),o.remove(),t(e)}))}))}const Oe={"application/pdf":"pdf-256","application/zip":"archive-256","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"document-256","application/msword":"document-256","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"spreadsheet-256","application/vnd.ms-excel":"spreadsheet-256","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint-256","application/vnd.ms-powerpoint":"powerpoint-256","text/plain":"sourcecode-256","audio/mp3":"mp3-256","audio/mp4":"mp3-256","video/quicktime":"quicktime-256","video/mp4":"mpeg-256"},De=(e,t)=>{const n=Oe[e];return n?`/theme/image.php/classic/core/1601902087/f/${n}`:t};Le.extend((e=>{e.prototype.popupLogin=Ie})).extend((e=>{e.prototype.getCourseContent=ke}));const Ne=new Le,Re=async(e,t,n)=>{const o=await(async e=>{const t=new URLSearchParams(location.search),n=t.get("id");if(!n)return console.error('Could not extract courseId "%s"',t),!1;try{return await Ne.getCourseContent(n,!e)}catch{return await Ne.popupLogin("Open folders inline"),Ne.getCourseContent(n,!e)}})(n);if(!1===o)return!1;const r=o.find((({id:t})=>t===Number(e)));if(!r)return console.error("Could not find sectionObject."),!1;const{modules:s}=r,i=s.find((({id:e,modname:n})=>"folder"===n&&e===Number(t)));if(!i)return console.error("Could not find folderObject."),!1;const{contents:c}=i,a=[];for(const e of c)if("file"===e.type){const{filepath:t,mimetype:n}=e,o=Ne.resolveUrl(e.fileurl);o.pathname=o.pathname.replace(/^\/webservice/,"");const r=new URL(o.href);n?.startsWith("image")||r.searchParams.set("preview","1"),a.push({...e,filePath:(l=t,l.trim().split(/\/+/).filter(Boolean)),imgPath:De(n,r.href),fileUrl:o.href})}var l;return a};function je(e){let t,n,o,r,i,c,l,d,u,p,m;return{c(){t=w("div"),n=w("div"),o=w("i"),r=v(),i=w("img"),l=v(),d=w("span"),u=y(e[1]),C(o,"class","icon fa fa-fw navicon folders-inline-caret"),M(o,"fa-caret-right",e[0]),M(o,"fa-caret-down",!e[0]),C(i,"alt",""),C(i,"class","iconlarge activityicon"),C(i,"role","presentation"),C(i,"title",e[1]),C(i,"aria-hidden","true"),f(i.src,c="/theme/image.php/classic/core/1601902087/f/folder-128")||C(i,"src","/theme/image.php/classic/core/1601902087/f/folder-128"),C(n,"class","folders-inline-icon-div"),C(d,"class","fp-filename"),C(t,"class","fp-filename-icon folders-inline-icon")},m(s,c){g(s,t,c),h(t,n),h(n,o),h(n,r),h(n,i),h(t,l),h(t,d),h(d,u),p||(m=[k(t,"click",_(x(e[2]))),k(t,"keydown",e[3])],p=!0)},p(e,[t]){1&t&&M(o,"fa-caret-right",e[0]),1&t&&M(o,"fa-caret-down",!e[0]),2&t&&C(i,"title",e[1]),2&t&&E(u,e[1])},i:s,o:s,d(e){e&&$(t),p=!1,a(m)}}}function He(e,t,n){let{isHidden:o}=t,{base:r}=t;const s=D();function i(){s("click")}return e.$$set=e=>{"isHidden"in e&&n(0,o=e.isHidden),"base"in e&&n(1,r=e.base)},[o,r,i,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),i())}]}const Ge=class extends ce{constructor(e){super(),ie(this,e,He,je,d,{isHidden:0,base:1})}};function Te(e,t,n){const o=e.slice();return o[9]=t[n].fileUrl,o[10]=t[n].filename,o[11]=t[n].imgPath,o}function Ve(e,t,n){const o=e.slice();return o[14]=t[n][0],o[15]=t[n][1],o}function qe(e){let t,n;return t=new Ge({props:{isHidden:e[3],base:e[1]}}),t.$on("click",e[7]),{c(){oe(t.$$.fragment)},m(e,o){re(t,e,o),n=!0},p(e,n){const o={};8&n&&(o.isHidden=e[3]),2&n&&(o.base=e[1]),t.$set(o)},i(e){n||(X(t.$$.fragment,e),n=!0)},o(e){Y(t.$$.fragment,e),n=!1},d(e){se(t,e)}}}function ze(e){let t,n,o,r=[],s=new Map,i=[],c=new Map,a=e[4];const l=e=>e[14];for(let t=0;t<a.length;t+=1){let n=Ve(e,a,t),o=l(n);s.set(o,r[t]=Ae(o,n))}let d=e[5]??[];const u=e=>e[10];for(let t=0;t<d.length;t+=1){let n=Te(e,d,t),o=u(n);c.set(o,i[t]=Be(o,n))}return{c(){t=w("ul");for(let e=0;e<r.length;e+=1)r[e].c();n=v();for(let e=0;e<i.length;e+=1)i[e].c();P(t,"list-style","none")},m(e,s){g(e,t,s);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null);h(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);o=!0},p(e,o){17&o&&(a=e[4],J(),r=te(r,o,l,1,e,a,s,t,ee,Ae,n,Ve),Q()),32&o&&(d=e[5]??[],i=te(i,o,u,1,e,d,c,t,Z,Be,null,Te))},i(e){if(!o){for(let e=0;e<a.length;e+=1)X(r[e]);o=!0}},o(e){for(let e=0;e<r.length;e+=1)Y(r[e]);o=!1},d(e){e&&$(t);for(let e=0;e<r.length;e+=1)r[e].d();for(let e=0;e<i.length;e+=1)i[e].d()}}}function Ae(e,t){let n,o,r;return o=new We({props:{contents:t[15],base:t[14],directoryDepth:t[0]+1}}),{key:e,first:null,c(){n=w("li"),oe(o.$$.fragment),this.first=n},m(e,t){g(e,n,t),re(o,n,null),r=!0},p(e,n){t=e;const r={};16&n&&(r.contents=t[15]),16&n&&(r.base=t[14]),1&n&&(r.directoryDepth=t[0]+1),o.$set(r)},i(e){r||(X(o.$$.fragment,e),r=!0)},o(e){Y(o.$$.fragment,e),r=!1},d(e){e&&$(n),se(o)}}}function Be(e,t){let n,o,r,s,i,c,a,l,d,u,p,m,b=t[10]+"";return{key:e,first:null,c(){n=w("li"),o=w("span"),r=w("a"),s=w("span"),i=w("img"),l=v(),d=w("span"),u=y(b),m=v(),C(i,"alt",""),C(i,"title",c=t[10]),f(i.src,a=t[11])||C(i,"src",a),C(s,"class","fp-icon"),C(d,"class","fp-filename"),C(r,"href",p=ae(t[9])),C(o,"class","fp-filename-icon"),this.first=n},m(e,t){g(e,n,t),h(n,o),h(o,r),h(r,s),h(s,i),h(r,l),h(r,d),h(d,u),h(n,m)},p(e,n){t=e,32&n&&c!==(c=t[10])&&C(i,"title",c),32&n&&!f(i.src,a=t[11])&&C(i,"src",a),32&n&&b!==(b=t[10]+"")&&E(u,b),32&n&&p!==(p=ae(t[9]))&&C(r,"href",p)},d(e){e&&$(n)}}}function Fe(e){let t,n,o,r=!e[2]&&qe(e),s=!e[6]&&ze(e);return{c(){r&&r.c(),t=v(),s&&s.c(),n=b()},m(e,i){r&&r.m(e,i),g(e,t,i),s&&s.m(e,i),g(e,n,i),o=!0},p(e,[o]){e[2]?r&&(J(),Y(r,1,1,(()=>{r=null})),Q()):r?(r.p(e,o),4&o&&X(r,1)):(r=qe(e),r.c(),X(r,1),r.m(t.parentNode,t)),e[6]?s&&(J(),Y(s,1,1,(()=>{s=null})),Q()):s?(s.p(e,o),64&o&&X(s,1)):(s=ze(e),s.c(),X(s,1),s.m(n.parentNode,n))},i(e){o||(X(r),X(s),o=!0)},o(e){Y(r),Y(s),o=!1},d(e){r&&r.d(e),e&&$(t),s&&s.d(e),e&&$(n)}}}function Ke(t,n,o){let r,s,i,c,{contents:a}=n,{directoryDepth:l}=n,{base:d}=n,{isParent:u}=n;return t.$$set=e=>{"contents"in e&&o(8,a=e.contents),"directoryDepth"in e&&o(0,l=e.directoryDepth),"base"in e&&o(1,d=e.base),"isParent"in e&&o(2,u=e.isParent)},t.$$.update=()=>{4&t.$$.dirty&&o(3,r=!u),12&t.$$.dirty&&o(6,s=r&&!u),257&t.$$.dirty&&o(5,({root:i,entries:c}=function(t,n){const o={};for(const e of t)if("isexternalfile"in e){const t=e.filePath[n]??"/";(o[t]??(o[t]=[])).push(e)}const r=o["/"];r?.sort(((t,n)=>e.compare(t.filename.trim(),n.filename.trim()))),delete o["/"];const s=Object.entries(o);return s.sort((([t],[n])=>e.compare(t.trim(),n.trim()))),{root:r,entries:s}}(a,l)),i,(o(4,c),o(8,a),o(0,l)))},[l,d,u,r,c,i,s,function(){o(3,r=!r)},a]}class We extends ce{constructor(e){super(),ie(this,e,Ke,Fe,d,{contents:8,directoryDepth:0,base:1,isParent:2})}}const Je=We;function Qe(e){let t,n,o,r,s;const i=[Ze,Ye,Xe],c=[];function a(e,t){return e[1]?0===e[1].length?1:2:0}return t=a(e),n=c[t]=i[t](e),r=new fe({props:{target:e[0]}}),r.$on("click",e[7]),{c(){n.c(),o=v(),oe(r.$$.fragment)},m(e,n){c[t].m(e,n),g(e,o,n),re(r,e,n),s=!0},p(e,s){let l=t;t=a(e),t===l?c[t].p(e,s):(J(),Y(c[l],1,1,(()=>{c[l]=null})),Q(),n=c[t],n?n.p(e,s):(n=c[t]=i[t](e),n.c()),X(n,1),n.m(o.parentNode,o));const d={};1&s&&(d.target=e[0]),r.$set(d)},i(e){s||(X(n),X(r.$$.fragment,e),s=!0)},o(e){Y(n),Y(r.$$.fragment,e),s=!1},d(e){c[t].d(e),e&&$(o),se(r,e)}}}function Xe(e){let t,n;return t=new Je({props:{directoryDepth:0,isParent:!0,contents:e[1]}}),{c(){oe(t.$$.fragment)},m(e,o){re(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.contents=e[1]),t.$set(o)},i(e){n||(X(t.$$.fragment,e),n=!0)},o(e){Y(t.$$.fragment,e),n=!1},d(e){se(t,e)}}}function Ye(e){let t;return{c(){t=w("div"),t.textContent="The folder was empty",C(t,"class","folder-empty")},m(e,n){g(e,t,n)},p:s,i:s,o:s,d(e){e&&$(t)}}}function Ze(e){let t;return{c(){t=w("div"),t.textContent="Loading",C(t,"class","folder-loading")},m(e,n){g(e,t,n)},p:s,i:s,o:s,d(e){e&&$(t)}}}function et(e){let t,n,o=!e[2]&&Qe(e);return{c(){o&&o.c(),t=b()},m(e,r){o&&o.m(e,r),g(e,t,r),n=!0},p(e,[n]){e[2]?o&&(J(),Y(o,1,1,(()=>{o=null})),Q()):o?(o.p(e,n),4&n&&X(o,1)):(o=Qe(e),o.c(),X(o,1),o.m(t.parentNode,t))},i(e){n||(X(o),n=!0)},o(e){Y(o),n=!1},d(e){o&&o.d(e),e&&$(t)}}}function tt(e,t,n){let o,{folderId:r}=t,{sectionId:s}=t,{anchor:i}=t,c=!1;var a;let l;async function d(e){n(1,o=void 0);const t=await Re(s,r,e);t&&n(1,o=t)}function u(e){e.ctrlKey||(e.preventDefault(),e.stopImmediatePropagation(),n(2,c=!c))}a=()=>{d(!0)},O().$$.on_mount.push(a);return e.$$set=e=>{"folderId"in e&&n(4,r=e.folderId),"sectionId"in e&&n(5,s=e.sectionId),"anchor"in e&&n(0,i=e.anchor)},e.$$.update=()=>{65&e.$$.dirty&&(l!==i&&l?.removeEventListener("click",u),n(6,l=i),i.addEventListener("click",u))},[i,o,c,d,r,s,l,()=>{d(!1)}]}const nt=class extends ce{constructor(e){super(),ie(this,e,tt,et,d,{folderId:4,sectionId:5,anchor:0})}};function ot(e){if(e.ctrlKey)return;if(!(e.target instanceof Element))return;const t=e.target.closest("a");if("/mod/folder/view.php"!==t?.pathname)return;const n=t.closest("li.activity.folder");if(!n)return;const o=/\d+$/.exec(n.id)?.[0];if(!o)return void console.error("Could not get folderId.");const r=t.closest("li.section.main"),s=r?.getAttribute("aria-labelledby")?.match(/-(\d+)-/)?.[1];if(!s)return void console.error("sectionId was undefined.");e.preventDefault();const i=document.createElement("span");i.className="folder-parent",new nt({target:i,props:{sectionId:s,folderId:o,anchor:t}}),n.append(i)}var rt;
// ==UserScript==
// @name      Moodle Open Folders Inline
// @version   4.0.1
// @author    lusc
// @match     *://moodle.*/course/view.php?id=*
// @match     *://moodle*.*/course/view.php?id=*
// @updateURL https://github.com/melusc/moodle_userscripts/raw/userscript-out/Open%20folders%20inline/open-folders-inline.user.js
// @grant     GM_setValue
// @grant     GM_getValue
// @grant     GM_deleteValue
// @grant     GM_addStyle
// @run-at    document-start
// @license   MIT
// ==/UserScript==
(e=>{try{(e=>{const n=GM_getValue(r),s=void 0===n?[-1,-1,-1]:t(n),i=Object.entries(e).map((([e,n])=>[t(e),n])).sort((([e],[t])=>o(e,t)));for(const[e,t]of i)o(s,e)<0&&t();GM_setValue(r,GM_info.script.version)})(e)}catch(e){console.error("Upgrading threw %o. Failing silently.",e)}})({"1.2.0":()=>{GM_deleteValue("lastValidatedToken"),GM_deleteValue("password")}}),GM_addStyle('@keyframes folder-loading-dots{0%{content:""}33%{content:"."}67%{content:".."}to{content:"..."}}div.folders-inline-icon{cursor:pointer;user-select:none}div.folders-inline-icon-div{display:inline}.folder-parent li{margin-left:24px;padding-left:none}.folder-empty,.folder-loading{margin-left:calc(1rem + 24px)}.folder-loading::after{content:"";animation:folder-loading-dots .6s infinite linear alternate}'),rt=function(){document.querySelector("div.course-content > ul")?.addEventListener("click",ot)},"interactive"!==document.readyState&&"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",rt,{once:!0}):rt()})();