/*! For license information please see open-folders-inline.user.js.LICENSE.txt */
(()=>{"use strict";const e=e=>{if(!/^\d+\.\d+\.\d+$/.test(e))throw new Error(`Invalid version: ${e}.`);const[t,n,o]=e.split(".").map(Number);return[t,n,o]},t=(e,t)=>e-t,n=(e,n)=>t(e[0],n[0])||t(e[1],n[1])||t(e[2],n[2]),o="lastUpgraded";function r(){}function s(e){return e()}function i(){return Object.create(null)}function c(e){e.forEach(s)}function a(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let d;function u(e,t){return d||(d=document.createElement("a")),d.href=t,e===d.href}function f(e){return 0===Object.keys(e).length}new Set;const p="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class m{constructor(e){this.options=e,this._listeners="WeakMap"in p?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return null!==(e=this._observer)&&void 0!==e?e:this._observer=new ResizeObserver((e=>{var t;for(const n of e)m.entries.set(n.target,n),null===(t=this._listeners.get(n.target))||void 0===t||t(n)}))}}m.entries="WeakMap"in p?new WeakMap:void 0;let h=!1;function g(e,t){e.appendChild(t)}function $(e,t,n){e.insertBefore(t,n||null)}function w(e){e.parentNode&&e.parentNode.removeChild(e)}function v(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function b(){return y(" ")}function k(){return y("")}function _(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function x(e){return function(t){return t.preventDefault(),e.call(this,t)}}function E(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function C(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function L(e,t){t=""+t,e.data!==t&&(e.data=t)}function M(e,t){e.value=null==t?"":t}function P(e,t,n,o){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function U(e,t,n){e.classList[n?"add":"remove"](t)}function S(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}new Map;let O;function I(e){O=e}function D(){if(!O)throw new Error("Function called outside component initialization");return O}function N(){const e=D();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const s=S(t,n,{cancelable:o});return r.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}const R=[],j=[];let H=[];const G=[],T=Promise.resolve();let V=!1;function q(){V||(V=!0,T.then(W))}function z(e){H.push(e)}const A=new Set;let B=0;function W(){if(0!==B)return;const e=O;do{try{for(;B<R.length;){const e=R[B];B++,I(e),F(e.$$)}}catch(e){throw R.length=0,B=0,e}for(I(null),R.length=0,B=0;j.length;)j.pop()();for(let e=0;e<H.length;e+=1){const t=H[e];A.has(t)||(A.add(t),t())}H.length=0}while(R.length);for(;G.length;)G.pop()();V=!1,A.clear(),I(e)}function F(e){if(null!==e.fragment){e.update(),c(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(z)}}const K=new Set;let J;function Q(){J={r:0,c:[],p:J}}function X(){J.r||c(J.c),J=J.p}function Y(e,t){e&&e.i&&(K.delete(e),e.i(t))}function Z(e,t,n,o){if(e&&e.o){if(K.has(e))return;K.add(e),J.c.push((()=>{K.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}function ee(e,t){e.d(1),t.delete(e.key)}function te(e,t){Z(e,1,1,(()=>{t.delete(e.key)}))}function ne(e,t,n,o,r,s,i,a,l,d,u,f){let p=e.length,m=s.length,h=p;const g={};for(;h--;)g[e[h].key]=h;const $=[],w=new Map,v=new Map,y=[];for(h=m;h--;){const e=f(r,s,h),c=n(e);let a=i.get(c);a?o&&y.push((()=>a.p(e,t))):(a=d(c,e),a.c()),w.set(c,$[h]=a),c in g&&v.set(c,Math.abs(h-g[c]))}const b=new Set,k=new Set;function _(e){Y(e,1),e.m(a,u),i.set(e.key,e),u=e.first,m--}for(;p&&m;){const t=$[m-1],n=e[p-1],o=t.key,r=n.key;t===n?(u=t.first,p--,m--):w.has(r)?!i.has(o)||b.has(o)?_(t):k.has(r)?p--:v.get(o)>v.get(r)?(k.add(o),_(t)):(b.add(r),p--):(l(n,i),p--)}for(;p--;){const t=e[p];w.has(t.key)||l(t,i)}for(;m;)_($[m-1]);return c(y),$}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let oe;function re(e){e&&e.c()}function se(e,t,n,o){const{fragment:r,after_update:i}=e.$$;r&&r.m(t,n),o||z((()=>{const t=e.$$.on_mount.map(s).filter(a);e.$$.on_destroy?e.$$.on_destroy.push(...t):c(t),e.$$.on_mount=[]})),i.forEach(z)}function ie(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];H.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),H=t}(n.after_update),c(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ce(e,t,n,o,s,a,l,d=[-1]){const u=O;I(e);const f=e.$$={fragment:null,ctx:[],props:a,update:r,not_equal:s,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:i(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};l&&l(f.root);let p=!1;if(f.ctx=n?n(e,t.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&s(f.ctx[t],f.ctx[t]=r)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](r),p&&function(e,t){-1===e.$$.dirty[0]&&(R.push(e),q(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],f.update(),p=!0,c(f.before_update),f.fragment=!!o&&o(f.ctx),t.target){if(t.hydrate){h=!0;const e=(m=t.target,Array.from(m.childNodes));f.fragment&&f.fragment.l(e),e.forEach(w)}else f.fragment&&f.fragment.c();t.intro&&Y(e.$$.fragment),se(e,t.target,t.anchor,t.customElement),h=!1,W()}var m;I(u)}"function"==typeof HTMLElement&&(oe=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(s).filter(a);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){c(this.$$.on_disconnect)}$destroy(){ie(this,1),this.$destroy=r}$on(e,t){if(!a(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!f(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class ae{$destroy(){ie(this,1),this.$destroy=r}$on(e,t){if(!a(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!f(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const le=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0});function de(e){const t=new URL(e);return"1"===t.searchParams.get("forcedownload")&&t.searchParams.set("forcedownload","0"),t.href}function ue(e,t){function n(){t.append(e)}return n(),{update:n,destroy:function(){e.remove()}}}function fe(e){let t,n,o,s;return{c(){t=v("span"),t.innerHTML='<svg fill="currentColor" aria-hidden="true" class="icon navicon svg-refresh" viewBox="0 0 512 512"><path d="M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"></path></svg>',C(t,"class","svg-refresh-hitbox"),P(t,"margin-left","5px")},m(i,c){var l;$(i,t,c),o||(s=[(l=n=ue.call(null,t,e[0]),l&&a(l.destroy)?l.destroy:r),_(t,"click",E(x(e[1]))),_(t,"keydown",e[2])],o=!0)},p(e,[t]){n&&a(n.update)&&1&t&&n.update.call(null,e[0])},i:r,o:r,d(e){e&&w(t),o=!1,c(s)}}}function pe(e,t,n){let{target:o}=t;const r=N();function s(){r("click")}return e.$$set=e=>{"target"in e&&n(0,o=e.target)},[o,s,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),s())}]}const me=class extends ae{constructor(e){super(),ce(this,e,pe,fe,l,{target:0})}},he=new Map;function ge(e){const t=Symbol(e.name);return function(...n){const o=n.slice(0,-1),r=[this,...o],s=n.at(-1),i=function(e){let t=he;for(const n of e)t.has(n)||t.set(n,new Map),t=t.get(n);return t}(r);if(s&&i.has(t))return i.get(t);const c=e.apply(this,o);return i.set(t,c),c instanceof Promise&&c.catch((()=>{i.delete(t)})),c}}async function $e(e){return await this.fetch("core_course_get_contents",{courseid:String(e),"options[0][name]":"includestealthmodules","options[0][value]":"1"})}var we;!function(e){e.username="username",e.token="token"}(we||(we={}));const ve=e=>[()=>GM_getValue(e),t=>{GM_setValue(e,t)},()=>{GM_deleteValue(e)}],[ye,be,ke]=ve(we.token),[_e,xe,Ee]=ve(we.username);class Ce extends Error{constructor(){super("No credentials provided.")}}class Le extends Error{constructor(){super("Invalid credentials.")}}class Me extends Error{constructor(e){super(`${e} not included`)}}let Pe=new URL("http://localhost/");"undefined"!=typeof location?Pe=new URL("/",location.href):"undefined"!=typeof process&&"string"==typeof process.env.MOODLE_BASE_URL&&(Pe=new URL(process.env.MOODLE_BASE_URL));class Ue{static extend(e){return e(Ue),Ue}baseUrl=Pe;credentials={token:ye(),username:_e()};resolveUrl=e=>new URL(e,this.baseUrl);async login(e){const{credentials:t}=this;if(e&&(t.username=e.username,t.password=e.password,xe(e.username)),t.token)return t.token;const{username:n,password:o}=t;if(!n||!o)throw new Ce;const r=new URLSearchParams({username:n,password:o,service:"moodle_mobile_app"}),s=await fetch(this.resolveUrl("/login/token.php"),{method:"POST",body:r.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}});if(!s.ok)throw new Error(`Response was not ok: ${s.status}`);const i=await s.json();if("errorcode"in i)throw this.logout(),new Le;const{token:c}=i;return be(c),t.token=c,c}async fetch(e,t){const n=new URLSearchParams(t);n.set("wstoken",await this.login()),n.set("wsfunction",e),n.set("moodlewsrestformat","json");const o=await fetch(this.resolveUrl("/webservice/rest/server.php"),{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:n.toString()});if(!o.ok)throw new Error(`Response was not ok: ${o.status}`);const r=await o.json(),s=r;if("exception"in s)throw this.logout(),new Error(`Error(${s.exception}): ${s.message}`);return r}logout(){delete this.credentials.token,ke(),delete this.credentials.password}async getCourses(e){throw new Me("getCourses")}async getUserId(e){throw new Me("getUserId")}async popupLogin(e,t){throw new Me("popupLogin")}async getCourseContent(e,t){throw new Me("getCourseContent")}}function Se(e){let t,n,o,r,s,i,a,l,d,u,f,p,m,h,k,P,S,O,I,D,N;return{c(){t=v("div"),n=v("form"),o=v("div"),r=v("div"),s=v("h5"),i=y("Login - "),a=y(e[0]),l=b(),d=v("div"),u=v("label"),u.textContent="Username",f=b(),p=v("input"),m=b(),h=v("div"),k=v("label"),k.textContent="Password",P=b(),S=v("input"),O=b(),I=v("button"),I.textContent="Login",C(s,"class","card-title"),C(u,"for","popup-username"),C(u,"class","form-label"),p.required=!0,C(p,"id","popup-username"),C(p,"placeholder","Username"),C(p,"class","form-control"),U(p,"is-invalid",""===e[2].trim()),C(d,"class","mb-3"),C(k,"for","popup-password"),C(k,"class","form-label"),S.required=!0,C(S,"id","popup-password"),C(S,"placeholder","Password"),C(S,"class","form-control"),C(S,"type","password"),U(S,"is-invalid",""===e[3]),C(h,"class","mb-3"),C(r,"class","card-body"),C(I,"class","btn btn-primary"),C(I,"type","submit"),C(o,"class","card shadow"),C(t,"class","vertical-horizontal-center")},m(c,w){$(c,t,w),g(t,n),g(n,o),g(o,r),g(r,s),g(s,i),g(s,a),g(r,l),g(r,d),g(d,u),g(d,f),g(d,p),M(p,e[2]),g(r,m),g(r,h),g(h,k),g(h,P),g(h,S),M(S,e[3]),g(o,O),g(o,I),D||(N=[_(p,"input",e[6]),_(S,"input",e[7]),_(n,"submit",E(x(e[4])))],D=!0)},p(e,t){1&t&&L(a,e[0]),4&t&&p.value!==e[2]&&M(p,e[2]),4&t&&U(p,"is-invalid",""===e[2].trim()),8&t&&S.value!==e[3]&&M(S,e[3]),8&t&&U(S,"is-invalid",""===e[3])},d(e){e&&w(t),D=!1,c(N)}}}function Oe(e){let t,n=e[1]&&Se(e);return{c(){n&&n.c(),t=k()},m(e,o){n&&n.m(e,o),$(e,t,o)},p(e,[o]){e[1]?n?n.p(e,o):(n=Se(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:r,o:r,d(e){n&&n.d(e),e&&w(t)}}}function Ie(e,t,n){let{title:o}=t,{moodle:r}=t;const s=N();let i=!0,c=_e()??"",a="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"moodle"in e&&n(5,r=e.moodle)},[o,i,c,a,async function(){if(n(2,c=c.trim()),c&&a){n(1,i=!1);try{const e=await r.login({username:c,password:a});s("login",e)}catch{n(1,i=!0)}}},r,function(){c=this.value,n(2,c)},function(){a=this.value,n(3,a)}]}const De=class extends ae{constructor(e){super(),ce(this,e,Ie,Oe,l,{title:0,moodle:5})}};async function Ne(e){return new Promise((t=>{const n=GM_addStyle(".login-popup-userscript .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.login-popup-userscript .card{pointer-events:auto}"),o=document.createElement("div");o.className="login-popup-userscript",document.body.append(o);const r=new De({target:o,props:{title:e,moodle:this}});r.$on("login",(({detail:e})=>{r.$destroy(),n.remove(),o.remove(),t(e)}))}))}const Re={"application/pdf":"pdf-256","application/zip":"archive-256","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"document-256","application/msword":"document-256","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"spreadsheet-256","application/vnd.ms-excel":"spreadsheet-256","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint-256","application/vnd.ms-powerpoint":"powerpoint-256","text/plain":"sourcecode-256","audio/mp3":"mp3-256","audio/mp4":"mp3-256","video/quicktime":"quicktime-256","video/mp4":"mpeg-256"},je=(e,t)=>{const n=Re[e];return n?`/theme/image.php/classic/core/1601902087/f/${n}`:t};Ue.extend((e=>{e.prototype.popupLogin=ge(Ne)})).extend((e=>{e.prototype.getCourseContent=ge($e)}));const He=new Ue,Ge=async e=>{const t=new URLSearchParams(location.search),n=t.get("id");if(!n)return console.error('Could not extract courseId "%s"',t),!1;try{return await He.fetch("core_course_get_contents",{courseid:n,"options[0][name]":"sectionid","options[0][value]":e,"options[1][name]":"modname","options[1][value]":"folder"})}catch{return await He.popupLogin("Open folders inline",!0),Ge(e)}},Te=ge((async(e,t)=>{const n=await Ge(e);if(!1===n)return!1;const o=n.find((({id:t})=>t===Number(e)));if(!o)return console.error("Could not find sectionObject."),!1;const{modules:r}=o,s=r.find((({id:e,modname:n})=>"folder"===n&&e===Number(t)));if(!s)return console.error("Could not find folderObject."),!1;const{contents:i}=s,c=[];for(const e of i)if("file"===e.type){const{filepath:t,mimetype:n}=e,o=He.resolveUrl(e.fileurl);o.pathname=o.pathname.replace(/^\/webservice/,"");const r=new URL(o.href);n?.startsWith("image")||r.searchParams.set("preview","1"),c.push({...e,filePath:(a=t,a.trim().split(/\/+/).filter(Boolean)),imgPath:je(n,r.href),fileUrl:o.href})}var a;return c}));function Ve(e){let t,n,o,s,i,a,l,d,f,p,m;return{c(){t=v("div"),n=v("div"),o=v("i"),s=b(),i=v("img"),l=b(),d=v("span"),f=y(e[1]),C(o,"class","icon fa fa-fw navicon folders-inline-caret"),U(o,"fa-caret-right",e[0]),U(o,"fa-caret-down",!e[0]),C(i,"alt",""),C(i,"class","iconlarge activityicon"),C(i,"role","presentation"),C(i,"title",e[1]),C(i,"aria-hidden","true"),u(i.src,a="/theme/image.php/classic/core/1601902087/f/folder-128")||C(i,"src","/theme/image.php/classic/core/1601902087/f/folder-128"),C(n,"class","folders-inline-icon-div"),C(d,"class","fp-filename"),C(t,"class","fp-filename-icon folders-inline-icon")},m(r,c){$(r,t,c),g(t,n),g(n,o),g(n,s),g(n,i),g(t,l),g(t,d),g(d,f),p||(m=[_(t,"click",E(x(e[2]))),_(t,"keydown",e[3])],p=!0)},p(e,[t]){1&t&&U(o,"fa-caret-right",e[0]),1&t&&U(o,"fa-caret-down",!e[0]),2&t&&C(i,"title",e[1]),2&t&&L(f,e[1])},i:r,o:r,d(e){e&&w(t),p=!1,c(m)}}}function qe(e,t,n){let{isHidden:o}=t,{base:r}=t;const s=N();function i(){s("click")}return e.$$set=e=>{"isHidden"in e&&n(0,o=e.isHidden),"base"in e&&n(1,r=e.base)},[o,r,i,e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),i())}]}const ze=class extends ae{constructor(e){super(),ce(this,e,qe,Ve,l,{isHidden:0,base:1})}};function Ae(e,t,n){const o=e.slice();return o[9]=t[n].fileUrl,o[10]=t[n].filename,o[11]=t[n].imgPath,o}function Be(e,t,n){const o=e.slice();return o[14]=t[n][0],o[15]=t[n][1],o}function We(e){let t,n;return t=new ze({props:{isHidden:e[3],base:e[1]}}),t.$on("click",e[7]),{c(){re(t.$$.fragment)},m(e,o){se(t,e,o),n=!0},p(e,n){const o={};8&n&&(o.isHidden=e[3]),2&n&&(o.base=e[1]),t.$set(o)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){Z(t.$$.fragment,e),n=!1},d(e){ie(t,e)}}}function Fe(e){let t,n,o,r=[],s=new Map,i=[],c=new Map,a=e[4];const l=e=>e[14];for(let t=0;t<a.length;t+=1){let n=Be(e,a,t),o=l(n);s.set(o,r[t]=Ke(o,n))}let d=e[5]??[];const u=e=>e[10];for(let t=0;t<d.length;t+=1){let n=Ae(e,d,t),o=u(n);c.set(o,i[t]=Je(o,n))}return{c(){t=v("ul");for(let e=0;e<r.length;e+=1)r[e].c();n=b();for(let e=0;e<i.length;e+=1)i[e].c();P(t,"list-style","none")},m(e,s){$(e,t,s);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null);g(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);o=!0},p(e,o){17&o&&(a=e[4],Q(),r=ne(r,o,l,1,e,a,s,t,te,Ke,n,Be),X()),32&o&&(d=e[5]??[],i=ne(i,o,u,1,e,d,c,t,ee,Je,null,Ae))},i(e){if(!o){for(let e=0;e<a.length;e+=1)Y(r[e]);o=!0}},o(e){for(let e=0;e<r.length;e+=1)Z(r[e]);o=!1},d(e){e&&w(t);for(let e=0;e<r.length;e+=1)r[e].d();for(let e=0;e<i.length;e+=1)i[e].d()}}}function Ke(e,t){let n,o,r;return o=new Ye({props:{contents:t[15],base:t[14],directoryDepth:t[0]+1}}),{key:e,first:null,c(){n=v("li"),re(o.$$.fragment),this.first=n},m(e,t){$(e,n,t),se(o,n,null),r=!0},p(e,n){t=e;const r={};16&n&&(r.contents=t[15]),16&n&&(r.base=t[14]),1&n&&(r.directoryDepth=t[0]+1),o.$set(r)},i(e){r||(Y(o.$$.fragment,e),r=!0)},o(e){Z(o.$$.fragment,e),r=!1},d(e){e&&w(n),ie(o)}}}function Je(e,t){let n,o,r,s,i,c,a,l,d,f,p,m,h=t[10]+"";return{key:e,first:null,c(){n=v("li"),o=v("span"),r=v("a"),s=v("span"),i=v("img"),l=b(),d=v("span"),f=y(h),m=b(),C(i,"alt",""),C(i,"title",c=t[10]),u(i.src,a=t[11])||C(i,"src",a),C(s,"class","fp-icon"),C(d,"class","fp-filename"),C(r,"href",p=de(t[9])),C(o,"class","fp-filename-icon"),this.first=n},m(e,t){$(e,n,t),g(n,o),g(o,r),g(r,s),g(s,i),g(r,l),g(r,d),g(d,f),g(n,m)},p(e,n){t=e,32&n&&c!==(c=t[10])&&C(i,"title",c),32&n&&!u(i.src,a=t[11])&&C(i,"src",a),32&n&&h!==(h=t[10]+"")&&L(f,h),32&n&&p!==(p=de(t[9]))&&C(r,"href",p)},d(e){e&&w(n)}}}function Qe(e){let t,n,o,r=!e[2]&&We(e),s=!e[6]&&Fe(e);return{c(){r&&r.c(),t=b(),s&&s.c(),n=k()},m(e,i){r&&r.m(e,i),$(e,t,i),s&&s.m(e,i),$(e,n,i),o=!0},p(e,[o]){e[2]?r&&(Q(),Z(r,1,1,(()=>{r=null})),X()):r?(r.p(e,o),4&o&&Y(r,1)):(r=We(e),r.c(),Y(r,1),r.m(t.parentNode,t)),e[6]?s&&(Q(),Z(s,1,1,(()=>{s=null})),X()):s?(s.p(e,o),64&o&&Y(s,1)):(s=Fe(e),s.c(),Y(s,1),s.m(n.parentNode,n))},i(e){o||(Y(r),Y(s),o=!0)},o(e){Z(r),Z(s),o=!1},d(e){r&&r.d(e),e&&w(t),s&&s.d(e),e&&w(n)}}}function Xe(e,t,n){let o,r,s,{contents:i}=t,{directoryDepth:c}=t,{base:a}=t,{isParent:l}=t,d=!l;return e.$$set=e=>{"contents"in e&&n(8,i=e.contents),"directoryDepth"in e&&n(0,c=e.directoryDepth),"base"in e&&n(1,a=e.base),"isParent"in e&&n(2,l=e.isParent)},e.$$.update=()=>{12&e.$$.dirty&&n(6,o=d&&!l),257&e.$$.dirty&&n(5,({root:r,entries:s}=function(e,t){const n={};for(const o of e)if("isexternalfile"in o){const e=o.filePath[t]??"/";(n[e]??(n[e]=[])).push(o)}const o=n["/"];o?.sort(((e,t)=>le.compare(e.filename.trim(),t.filename.trim()))),delete n["/"];const r=Object.entries(n);return r.sort((([e],[t])=>le.compare(e.trim(),t.trim()))),{root:o,entries:r}}(i,c)),r,(n(4,s),n(8,i),n(0,c)))},[c,a,l,d,s,r,o,function(){n(3,d=!d)},i]}class Ye extends ae{constructor(e){super(),ce(this,e,Xe,Qe,l,{contents:8,directoryDepth:0,base:1,isParent:2})}}const Ze=Ye;function et(e){let t,n,o,r,s;const i=[ot,nt,tt],c=[];function a(e,t){return e[1]?0===e[1].length?1:2:0}return t=a(e),n=c[t]=i[t](e),r=new me({props:{target:e[0]}}),r.$on("click",e[7]),{c(){n.c(),o=b(),re(r.$$.fragment)},m(e,n){c[t].m(e,n),$(e,o,n),se(r,e,n),s=!0},p(e,s){let l=t;t=a(e),t===l?c[t].p(e,s):(Q(),Z(c[l],1,1,(()=>{c[l]=null})),X(),n=c[t],n?n.p(e,s):(n=c[t]=i[t](e),n.c()),Y(n,1),n.m(o.parentNode,o));const d={};1&s&&(d.target=e[0]),r.$set(d)},i(e){s||(Y(n),Y(r.$$.fragment,e),s=!0)},o(e){Z(n),Z(r.$$.fragment,e),s=!1},d(e){c[t].d(e),e&&w(o),ie(r,e)}}}function tt(e){let t,n;return t=new Ze({props:{directoryDepth:0,isParent:!0,contents:e[1]}}),{c(){re(t.$$.fragment)},m(e,o){se(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.contents=e[1]),t.$set(o)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){Z(t.$$.fragment,e),n=!1},d(e){ie(t,e)}}}function nt(e){let t;return{c(){t=v("div"),t.textContent="The folder was empty",C(t,"class","folder-empty")},m(e,n){$(e,t,n)},p:r,i:r,o:r,d(e){e&&w(t)}}}function ot(e){let t;return{c(){t=v("div"),t.textContent="Loading",C(t,"class","folder-loading")},m(e,n){$(e,t,n)},p:r,i:r,o:r,d(e){e&&w(t)}}}function rt(e){let t,n,o=!e[2]&&et(e);return{c(){o&&o.c(),t=k()},m(e,r){o&&o.m(e,r),$(e,t,r),n=!0},p(e,[n]){e[2]?o&&(Q(),Z(o,1,1,(()=>{o=null})),X()):o?(o.p(e,n),4&n&&Y(o,1)):(o=et(e),o.c(),Y(o,1),o.m(t.parentNode,t))},i(e){n||(Y(o),n=!0)},o(e){Z(o),n=!1},d(e){o&&o.d(e),e&&w(t)}}}function st(e,t,n){let o,{folderId:r}=t,{sectionId:s}=t,{anchor:i}=t,c=!1;var a;let l;async function d(e){n(1,o=void 0);const t=await Te(s,r,e);t&&n(1,o=t)}function u(e){e.ctrlKey||(e.preventDefault(),e.stopImmediatePropagation(),n(2,c=!c))}a=()=>{d(!0)},D().$$.on_mount.push(a);return e.$$set=e=>{"folderId"in e&&n(4,r=e.folderId),"sectionId"in e&&n(5,s=e.sectionId),"anchor"in e&&n(0,i=e.anchor)},e.$$.update=()=>{65&e.$$.dirty&&(l!==i&&l?.removeEventListener("click",u),n(6,l=i),i.addEventListener("click",u))},[i,o,c,d,r,s,l,()=>{d(!1)}]}const it=class extends ae{constructor(e){super(),ce(this,e,st,rt,l,{folderId:4,sectionId:5,anchor:0})}};function ct(e){if(e.ctrlKey)return;if(!(e.target instanceof Element))return;const t=e.target.closest("a");if("/mod/folder/view.php"!==t?.pathname)return;const n=t.closest("li.activity.folder");if(!n)return;const o=/\d+$/.exec(n.id)?.[0];if(!o)return void console.error("Could not get folderId.");const r=t.closest("li.section.main"),s=r?.getAttribute("aria-labelledby")?.match(/-(\d+)-/)?.[1];if(!s)return void console.error("sectionId was undefined.");e.preventDefault();const i=document.createElement("span");i.className="folder-parent",new it({target:i,props:{sectionId:s,folderId:o,anchor:t}}),n.append(i)}var at;
// ==UserScript==
// @name      Moodle Open Folders Inline
// @version   5.0.0
// @author    lusc
// @match     *://moodle.*/course/view.php?id=*
// @match     *://moodle*.*/course/view.php?id=*
// @updateURL https://github.com/melusc/moodle_userscripts/raw/userscript-out/Open%20folders%20inline/open-folders-inline.user.js
// @grant     GM_setValue
// @grant     GM_getValue
// @grant     GM_deleteValue
// @grant     GM_addStyle
// @run-at    document-start
// @license   MIT
// ==/UserScript==
(t=>{try{(t=>{const r=GM_getValue(o),s=void 0===r?[-1,-1,-1]:e(r),i=Object.entries(t).map((([t,n])=>[e(t),n])).sort((([e],[t])=>n(e,t)));for(const[e,t]of i)n(s,e)<0&&t();GM_setValue(o,GM_info.script.version)})(t)}catch(e){console.error("Upgrading threw %o. Failing silently.",e)}})({"1.2.0":()=>{GM_deleteValue("lastValidatedToken"),GM_deleteValue("password")}}),GM_addStyle('@keyframes folder-loading-dots{0%{content:""}33%{content:"."}67%{content:".."}to{content:"..."}}div.folders-inline-icon{cursor:pointer;user-select:none}div.folders-inline-icon-div{display:inline}.folder-parent li{margin-left:24px;padding-left:none}.folder-empty,.folder-loading{margin-left:calc(1rem + 24px)}.folder-loading::after{content:"";animation:folder-loading-dots .6s infinite linear alternate}'),at=function(){document.querySelector("div.course-content > ul")?.addEventListener("click",ct)},"interactive"!==document.readyState&&"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",at,{once:!0}):at()})();