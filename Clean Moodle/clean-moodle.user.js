/*! For license information please see clean-moodle.user.js.LICENSE.txt */
(()=>{"use strict";const e=()=>document.querySelector('#page-content li.type_system.depth_2 > ul[role="group"]'),t=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),n=e=>{if(!/^\d+\.\d+\.\d+$/.test(e))throw new Error(`Invalid version: ${e}.`);const[t,n,o]=e.split(".").map(Number);return[t,n,o]},o=(e,t)=>e-t,r=(e,t)=>o(e[0],t[0])||o(e[1],t[1])||o(e[2],t[2]),s="lastUpgraded";var i;!function(e){e.username="username",e.token="token"}(i||(i={}));const c=e=>[()=>GM_getValue(e),t=>{GM_setValue(e,t)},()=>{GM_deleteValue(e)}],[l,a,u]=c(i.token),[d,p,f]=c(i.username);Symbol("getCourseContent");const m=Symbol("getUserId");async function h(){const e=this._readCache(m);if(void 0!==e)return e;const t=await this.login(),n=new URLSearchParams({wsfunction:"core_webservice_get_site_info",wstoken:t}),o=await fetch(this.resolveUrl("/webservice/rest/server.php?moodlewsrestformat=json"),{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:n.toString()});if(!o.ok)throw new Error(`Response was not ok: ${o.status}`);const r=await o.json();if("exception"in r)throw this.logout(),new Error("token was undefined");return this._writeCache(m,r.userid)}const g=e=>{e.prototype.getUserId=h},w=Symbol("getCourses");async function v(e=!1){const t=this._readCache(w);if(t&&!e)return t;const n=await this.getUserId(),o=await this.login(),r=new URLSearchParams({wstoken:o,moodlewsrestformat:"json",wsfunction:"core_enrol_get_users_courses",userid:String(n),returnusercount:"0"}),s=await fetch(this.resolveUrl("/webservice/rest/server.php"),{method:"POST",body:r.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}});if(!s.ok)throw new Error(`Response was not ok: ${s.status}`);const i=await s.json();if("exception"in i)throw this.logout(),new Error("Token was invalid");const c=[];for(const{id:e,fullname:t}of i)c.push({id:e,name:t});return this._writeCache(w,c)}class $ extends Error{constructor(){super("No credentials provided.")}}class b extends Error{constructor(){super("Invalid credentials.")}}class y extends Error{constructor(e){super(`${e} not included`)}}let x=new URL("http://localhost/");"undefined"!=typeof location?x=new URL("/",location.href):"undefined"!=typeof process&&"string"==typeof process.env.MOODLE_BASE_URL&&(x=new URL(process.env.MOODLE_BASE_URL));class k{static extend(e){return e(k),k}baseUrl=x;credentials={token:l(),username:d()};#e=new Map;resolveUrl=e=>new URL(e,this.baseUrl);_readCache(e){return this.#e.get(e)}_writeCache(e,t){return this.#e.set(e,t),t}async login(e){const{credentials:t}=this;if(e&&(t.username=e.username,t.password=e.password,p(e.username)),t.token)return t.token;const{username:n,password:o}=t;if(!n||!o)throw new $;const r=new URLSearchParams({username:n,password:o,service:"moodle_mobile_app"}),s=await fetch(this.resolveUrl("/login/token.php"),{method:"POST",body:r.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}});if(!s.ok)throw new Error(`Response was not ok: ${s.status}`);const i=await s.json();if("errorcode"in i)throw this.logout(),new b;const{token:c}=i;return a(c),t.token=c,c}logout(){delete this.credentials.token,u(),delete this.credentials.password}async getCourses(e){throw new y("getCourses")}async getUserId(){throw new y("getUserId")}async popupLogin(e){throw new y("popupLogin")}async getCourseContent(e,t){throw new y("getCourseContent")}}function _(){}function C(e){return e()}function S(){return Object.create(null)}function E(e){e.forEach(C)}function M(e){return"function"==typeof e}function L(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function U(e){return 0===Object.keys(e).length}new Set;let N=!1;function G(e,t){e.appendChild(t)}function j(e,t,n){e.insertBefore(t,n||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function I(e){return document.createElement(e)}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function V(e){return document.createTextNode(e)}function z(){return V(" ")}function P(){return V("")}function R(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function A(e){return function(t){return t.preventDefault(),e.call(this,t)}}function q(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function B(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){t=""+t,e.data!==t&&(e.data=t)}function H(e,t){e.value=null==t?"":t}function F(e,t,n){e.classList[n?"add":"remove"](t)}function X(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}new Map;let Y;function J(e){Y=e}function K(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Q(){const e=K();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const s=X(t,n,{cancelable:o});return r.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}function W(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const Z=[],ee=[];let te=[];const ne=[],oe=Promise.resolve();let re=!1;function se(){re||(re=!0,oe.then(ae))}function ie(e){te.push(e)}const ce=new Set;let le=0;function ae(){if(0!==le)return;const e=Y;do{try{for(;le<Z.length;){const e=Z[le];le++,J(e),ue(e.$$)}}catch(e){throw Z.length=0,le=0,e}for(J(null),Z.length=0,le=0;ee.length;)ee.pop()();for(let e=0;e<te.length;e+=1){const t=te[e];ce.has(t)||(ce.add(t),t())}te.length=0}while(Z.length);for(;ne.length;)ne.pop()();re=!1,ce.clear(),J(e)}function ue(e){if(null!==e.fragment){e.update(),E(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ie)}}const de=new Set;let pe;function fe(){pe={r:0,c:[],p:pe}}function me(){pe.r||E(pe.c),pe=pe.p}function he(e,t){e&&e.i&&(de.delete(e),e.i(t))}function ge(e,t,n,o){if(e&&e.o){if(de.has(e))return;de.add(e),pe.c.push((()=>{de.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function we(e,t){ge(e,1,1,(()=>{t.delete(e.key)}))}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let ve;function $e(e){e&&e.c()}function be(e,t,n,o){const{fragment:r,after_update:s}=e.$$;r&&r.m(t,n),o||ie((()=>{const t=e.$$.on_mount.map(C).filter(M);e.$$.on_destroy?e.$$.on_destroy.push(...t):E(t),e.$$.on_mount=[]})),s.forEach(ie)}function ye(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];te.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),te=t}(n.after_update),E(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function xe(e,t,n,o,r,s,i,c=[-1]){const l=Y;J(e);const a=e.$$={fragment:null,ctx:[],props:s,update:_,not_equal:r,bound:S(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:S(),dirty:c,skip_bound:!1,root:t.target||l.$$.root};i&&i(a.root);let u=!1;if(a.ctx=n?n(e,t.props||{},((t,n,...o)=>{const s=o.length?o[0]:n;return a.ctx&&r(a.ctx[t],a.ctx[t]=s)&&(!a.skip_bound&&a.bound[t]&&a.bound[t](s),u&&function(e,t){-1===e.$$.dirty[0]&&(Z.push(e),se(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],a.update(),u=!0,E(a.before_update),a.fragment=!!o&&o(a.ctx),t.target){if(t.hydrate){N=!0;const e=(d=t.target,Array.from(d.childNodes));a.fragment&&a.fragment.l(e),e.forEach(O)}else a.fragment&&a.fragment.c();t.intro&&he(e.$$.fragment),be(e,t.target,t.anchor,t.customElement),N=!1,ae()}var d;J(l)}"function"==typeof HTMLElement&&(ve=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(C).filter(M);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){E(this.$$.on_disconnect)}$destroy(){ye(this,1),this.$destroy=_}$on(e,t){if(!M(t))return _;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!U(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class ke{$destroy(){ye(this,1),this.$destroy=_}$on(e,t){if(!M(t))return _;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!U(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function _e(e){let t,n,o,r,s,i,c,l,a,u,d,p,f,m,h,g,w,v,$,b,y;return{c(){t=I("div"),n=I("form"),o=I("div"),r=I("div"),s=I("h5"),i=V("Login - "),c=V(e[0]),l=z(),a=I("div"),u=I("label"),u.textContent="Username",d=z(),p=I("input"),f=z(),m=I("div"),h=I("label"),h.textContent="Password",g=z(),w=I("input"),v=z(),$=I("button"),$.textContent="Login",B(s,"class","card-title"),B(u,"for","popup-username"),B(u,"class","form-label"),p.required=!0,B(p,"id","popup-username"),B(p,"placeholder","Username"),B(p,"class","form-control"),F(p,"is-invalid",""===e[2].trim()),B(a,"class","mb-3"),B(h,"for","popup-password"),B(h,"class","form-label"),w.required=!0,B(w,"id","popup-password"),B(w,"placeholder","Password"),B(w,"class","form-control"),B(w,"type","password"),F(w,"is-invalid",""===e[3]),B(m,"class","mb-3"),B(r,"class","card-body"),B($,"class","btn btn-primary"),B($,"type","submit"),B(o,"class","card shadow"),B(t,"class","vertical-horizontal-center")},m(x,k){j(x,t,k),G(t,n),G(n,o),G(o,r),G(r,s),G(s,i),G(s,c),G(r,l),G(r,a),G(a,u),G(a,d),G(a,p),G(r,f),G(r,m),G(m,h),G(m,g),G(m,w),H(w,e[3]),G(o,v),G(o,$),b||(y=[R(w,"input",e[6]),R(n,"submit",q(A(e[4])))],b=!0)},p(e,t){1&t&&D(c,e[0]),4&t&&F(p,"is-invalid",""===e[2].trim()),8&t&&w.value!==e[3]&&H(w,e[3]),8&t&&F(w,"is-invalid",""===e[3])},d(e){e&&O(t),b=!1,E(y)}}}function Ce(e){let t,n=e[1]&&_e(e);return{c(){n&&n.c(),t=P()},m(e,o){n&&n.m(e,o),j(e,t,o)},p(e,[o]){e[1]?n?n.p(e,o):(n=_e(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:_,o:_,d(e){n&&n.d(e),e&&O(t)}}}function Se(e,t,n){let{title:o}=t,{moodle:r}=t;const s=Q();let i=!0,c=d()??"",l="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"moodle"in e&&n(5,r=e.moodle)},[o,i,c,l,async function(){if(n(2,c=c.trim()),c&&l){n(1,i=!1);try{const e=await r.login({username:c,password:l});s("login",e)}catch{n(1,i=!0)}}},r,function(){l=this.value,n(3,l)}]}const Ee=class extends ke{constructor(e){super(),xe(this,e,Se,Ce,L,{title:0,moodle:5})}};async function Me(e){return console.trace(this,e),new Promise((t=>{const n=GM_addStyle(".login-popup-userscript .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.login-popup-userscript .card{pointer-events:auto}"),o=document.createElement("div");o.className="login-popup-userscript",document.body.append(o);const r=new Ee({target:o,props:{title:e,moodle:this}});r.$on("login",(({detail:e})=>{r.$destroy(),n.remove(),o.remove(),t(e)}))}))}function Le(e){let t,n,o,r,s;return{c(){t=I("a"),n=T("svg"),o=T("path"),B(o,"d","M8.837 1.626c-.246-.835-1.428-.835-1.674 0l-.094.319A1.873 1.873 0 014.377 3.06l-.292-.16c-.764-.415-1.6.42-1.184 1.185l.159.292a1.873 1.873 0 01-1.115 2.692l-.319.094c-.835.246-.835 1.428 0 1.674l.319.094a1.873 1.873 0 011.115 2.693l-.16.291c-.415.764.42 1.6 1.185 1.184l.292-.159a1.873 1.873 0 012.692 1.116l.094.318c.246.835 1.428.835 1.674 0l.094-.319a1.873 1.873 0 012.693-1.115l.291.16c.764.415 1.6-.42 1.184-1.185l-.159-.291a1.873 1.873 0 011.116-2.693l.318-.094c.835-.246.835-1.428 0-1.674l-.319-.094a1.873 1.873 0 01-1.115-2.692l.16-.292c.415-.764-.42-1.6-1.185-1.184l-.291.159A1.873 1.873 0 018.93 1.945l-.094-.319zm-2.633-.283c.527-1.79 3.065-1.79 3.592 0l.094.319a.873.873 0 001.255.52l.292-.16c1.64-.892 3.434.901 2.54 2.541l-.159.292a.873.873 0 00.52 1.255l.319.094c1.79.527 1.79 3.065 0 3.592l-.319.094a.873.873 0 00-.52 1.255l.16.292c.893 1.64-.902 3.434-2.541 2.54l-.292-.159a.873.873 0 00-1.255.52l-.094.319c-.527 1.79-3.065 1.79-3.592 0l-.094-.319a.873.873 0 00-1.255-.52l-.292.16c-1.64.893-3.433-.902-2.54-2.541l.159-.292a.873.873 0 00-.52-1.255l-.319-.094c-1.79-.527-1.79-3.065 0-3.592l.319-.094a.873.873 0 00.52-1.255l-.16-.292c-.892-1.64.902-3.433 2.541-2.54l.292.159a.873.873 0 001.255-.52l.094-.319zM8 5.754a2.246 2.246 0 100 4.492 2.246 2.246 0 000-4.492zM4.754 8a3.246 3.246 0 116.492 0 3.246 3.246 0 01-6.492 0z"),B(n,"fill","currentColor"),B(n,"class","icon svg-icon-gear"),B(n,"viewBox","0 0 16 16"),function(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}(n,"margin-left","0.2em"),B(t,"href","/cleanMoodle"),B(t,"target","_blank"),B(t,"rel","noreferrer noopener")},m(i,c){j(i,t,c),G(t,n),G(n,o),r||(s=R(t,"click",q(e[0])),r=!0)},p:_,i:_,o:_,d(e){e&&O(t),r=!1,s()}}}function Ue(e){return[function(t){W.call(this,e,t)}]}const Ne=class extends ke{constructor(e){super(),xe(this,e,Ue,Le,L,{})}},Ge=()=>GM_getValue("overrides")??{},je=e=>Ge()[e],Oe=(e,t)=>{const n=Ge();n[e]=t,(e=>{GM_setValue("overrides",e)})(n)},Ie=e=>{const t=Ge();return delete t[e],GM_setValue("overrides",t),t};function Te(e){let t,n,o,r,s,i,c,l,a,u,d;return{c(){t=I("form"),n=I("div"),o=I("h5"),o.textContent="Login",r=z(),s=I("input"),i=z(),c=I("input"),l=z(),a=I("button"),a.textContent="Login",B(s,"placeholder","Username"),B(c,"placeholder","Password"),B(c,"type","password"),B(a,"class","btn-save"),B(a,"type","submit"),B(n,"class","replace-flex-input")},m(p,f){j(p,t,f),G(t,n),G(n,o),G(n,r),G(n,s),H(s,e[0]),G(n,i),G(n,c),H(c,e[1]),G(n,l),G(n,a),u||(d=[R(s,"input",e[3]),R(c,"input",e[4]),R(t,"submit",A(e[2]))],u=!0)},p(e,[t]){1&t&&s.value!==e[0]&&H(s,e[0]),2&t&&c.value!==e[1]&&H(c,e[1])},i:_,o:_,d(e){e&&O(t),u=!1,E(d)}}}function Ve(e,t,n){const o=Q();let r=d()??"",s="";return[r,s,function(){r&&s&&o("login",{username:r,password:s})},function(){r=this.value,n(0,r)},function(){s=this.value,n(1,s)}]}const ze=class extends ke{constructor(e){super(),xe(this,e,Ve,Te,L,{})}};function Pe(e){let t,n,o,r,s,i,c,l,a,u,d,p,f,m,h,g,w,v=void 0===e[0]?"Select course to the left":`Selected: ${e[0].courseName}`;return{c(){t=I("div"),n=I("div"),o=I("div"),o.textContent="Rename course",r=z(),s=I("form"),i=I("div"),c=V(v),l=z(),a=I("input"),p=z(),f=I("button"),m=V("Save"),B(o,"class","section-title"),B(a,"class","replace-input"),B(a,"placeholder",u=void 0===e[0]?"Select course to the left":`Leave empty to reset to ${e[0].courseName}`),a.disabled=d=void 0===e[0],a.value=e[2],B(f,"class","btn-save"),f.disabled=h=void 0===e[0],B(f,"type","submit"),B(s,"class","replace-flex-inputs"),B(n,"class","main"),B(t,"class","outer-main")},m(u,d){j(u,t,d),G(t,n),G(n,o),G(n,r),G(n,s),G(s,i),G(i,c),G(s,l),G(s,a),e[4](a),G(s,p),G(s,f),G(f,m),g||(w=[R(a,"input",e[5]),R(s,"submit",A(e[3]))],g=!0)},p(e,[t]){1&t&&v!==(v=void 0===e[0]?"Select course to the left":`Selected: ${e[0].courseName}`)&&D(c,v),1&t&&u!==(u=void 0===e[0]?"Select course to the left":`Leave empty to reset to ${e[0].courseName}`)&&B(a,"placeholder",u),1&t&&d!==(d=void 0===e[0])&&(a.disabled=d),4&t&&a.value!==e[2]&&(a.value=e[2]),1&t&&h!==(h=void 0===e[0])&&(f.disabled=h)},i:_,o:_,d(n){n&&O(t),e[4](null),g=!1,E(w)}}}function Re(e,t,n){let o,{selected:r}=t;const s=Q();let i,c;var l;l=()=>{i&&c!==r&&(c=r,i.focus(),i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}))},K().$$.after_update.push(l);return e.$$set=e=>{"selected"in e&&n(0,r=e.selected)},e.$$.update=()=>{1&e.$$.dirty&&n(2,o=(r?.value||r?.courseName)??"")},[r,i,o,function(){void 0!==r&&s("input",o)},function(e){ee[e?"unshift":"push"]((()=>{i=e,n(1,i)}))},e=>{n(2,o=e.currentTarget.value)}]}const Ae=class extends ke{constructor(e){super(),xe(this,e,Re,Pe,L,{selected:0})}};function qe(e){let t,n;return{c(){t=T("svg"),n=T("path"),B(n,"d","m9 11-4 4 4 4m-4-4h11a4 4 0 0 0 0-8h-1"),B(t,"fill","none"),B(t,"stroke","currentColor"),B(t,"stroke-linecap","round"),B(t,"stroke-linejoin","round"),B(t,"stroke-width","2"),B(t,"class","icon svg-icon-arrow-back"),B(t,"viewBox","0 0 24 24")},m(e,o){j(e,t,o),G(t,n)},p:_,i:_,o:_,d(e){e&&O(t)}}}const Be=class extends ke{constructor(e){super(),xe(this,e,null,qe,L,{})}};function De(e){let t,n;return{c(){t=T("svg"),n=T("path"),B(n,"d","m5 12 5 5L20 7"),B(t,"fill","none"),B(t,"stroke","currentColor"),B(t,"stroke-linecap","round"),B(t,"stroke-linejoin","round"),B(t,"stroke-width","2"),B(t,"class","icon svg-icon-check"),B(t,"viewBox","0 0 24 24")},m(e,o){j(e,t,o),G(t,n)},p:_,i:_,o:_,d(e){e&&O(t)}}}const He=class extends ke{constructor(e){super(),xe(this,e,null,De,L,{})}};function Fe(e){let t,n;return{c(){t=T("svg"),n=T("path"),B(n,"d","M18 6 6 18M6 6l12 12"),B(t,"fill","none"),B(t,"stroke","currentColor"),B(t,"stroke-linecap","round"),B(t,"stroke-linejoin","round"),B(t,"stroke-width","2"),B(t,"class","icon svg-icon-x"),B(t,"viewBox","0 0 24 24")},m(e,o){j(e,t,o),G(t,n)},p:_,i:_,o:_,d(e){e&&O(t)}}}const Xe=class extends ke{constructor(e){super(),xe(this,e,null,Fe,L,{})}},Ye=e=>e.sort((({courseName:e,value:n},{courseName:o,value:r})=>{const s=Je(n,e).trim(),i=Je(r,o).trim();return t.compare(s,i)})),Je=(e,t)=>"string"==typeof e?e:t;function Ke(e){let t,n;return t=new He({}),{c(){$e(t.$$.fragment)},m(e,o){be(t,e,o),n=!0},i(e){n||(he(t.$$.fragment,e),n=!0)},o(e){ge(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Qe(e){let t,n;return t=new Xe({}),{c(){$e(t.$$.fragment)},m(e,o){be(t,e,o),n=!0},i(e){n||(he(t.$$.fragment,e),n=!0)},o(e){ge(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function We(e){let t,n,o,r,s;return n=new Be({}),{c(){t=I("span"),$e(n.$$.fragment)},m(i,c){j(i,t,c),be(n,t,null),o=!0,r||(s=[R(t,"click",q(e[2])),R(t,"keydown",q(e[7]))],r=!0)},p:_,i(e){o||(he(n.$$.fragment,e),o=!0)},o(e){ge(n.$$.fragment,e),o=!1},d(e){e&&O(t),ye(n),r=!1,E(s)}}}function Ze(e){let t,n,o,r,s,i,c,l,a,u,d,p=Je(e[0],e[1])+"";const f=[Qe,Ke],m=[];function h(e,t){return!1===e[0]?0:1}o=h(e),r=m[o]=f[o](e);let g="string"==typeof e[0]&&We(e);return{c(){t=I("div"),n=I("span"),r.c(),s=z(),i=V(p),c=z(),g&&g.c(),B(t,"class",l="row"+(!1===e[0]?" removed":"")),B(t,"title",e[1])},m(r,l){j(r,t,l),G(t,n),m[o].m(n,null),G(t,s),G(t,i),G(t,c),g&&g.m(t,null),a=!0,u||(d=[R(n,"click",q(e[3])),R(n,"keydown",q(e[6])),R(t,"click",e[4]),R(t,"keydown",q(e[8]))],u=!0)},p(e,[s]){let c=o;o=h(e),o!==c&&(fe(),ge(m[c],1,1,(()=>{m[c]=null})),me(),r=m[o],r||(r=m[o]=f[o](e),r.c()),he(r,1),r.m(n,null)),(!a||3&s)&&p!==(p=Je(e[0],e[1])+"")&&D(i,p),"string"==typeof e[0]?g?(g.p(e,s),1&s&&he(g,1)):(g=We(e),g.c(),he(g,1),g.m(t,null)):g&&(fe(),ge(g,1,1,(()=>{g=null})),me()),(!a||1&s&&l!==(l="row"+(!1===e[0]?" removed":"")))&&B(t,"class",l),(!a||2&s)&&B(t,"title",e[1])},i(e){a||(he(r),he(g),a=!0)},o(e){ge(r),ge(g),a=!1},d(e){e&&O(t),m[o].d(),g&&g.d(),u=!1,E(d)}}}function et(e,t,n){let o,r,s,{course:i}=t;const c=Q();function l(){c("reset",s)}function a(){c("toggle",s)}function u(){c("select",i)}return e.$$set=e=>{"course"in e&&n(5,i=e.course)},e.$$.update=()=>{32&e.$$.dirty&&n(1,({courseName:o,value:r,courseId:s}=i),o,(n(0,r),n(5,i)))},[r,o,l,a,u,i,e=>{"Enter"===e.key&&a()},e=>{"Enter"===e.key&&l()},e=>{"Enter"===e.key&&u()}]}const tt=class extends ke{constructor(e){super(),xe(this,e,et,Ze,L,{course:5})}};function nt(e,t,n){const o=e.slice();return o[5]=t[n],o}function ot(e){let t;return{c(){t=I("div"),t.textContent="Loading courses..."},m(e,n){j(e,t,n)},d(e){e&&O(t)}}}function rt(e,t){let n,o,r;return o=new tt({props:{course:t[5]}}),o.$on("select",t[2]),o.$on("toggle",t[3]),o.$on("reset",t[4]),{key:e,first:null,c(){n=P(),$e(o.$$.fragment),this.first=n},m(e,t){j(e,n,t),be(o,e,t),r=!0},p(e,n){t=e;const r={};1&n&&(r.course=t[5]),o.$set(r)},i(e){r||(he(o.$$.fragment,e),r=!0)},o(e){ge(o.$$.fragment,e),r=!1},d(e){e&&O(n),ye(o,e)}}}function st(e){let t,n,o,r,s=[],i=new Map,c=e[1]&&ot(),l=e[0];const a=e=>e[5].courseId;for(let t=0;t<l.length;t+=1){let n=nt(e,l,t),o=a(n);i.set(o,s[t]=rt(o,n))}return{c(){t=I("div"),n=I("div"),c&&c.c(),o=z();for(let e=0;e<s.length;e+=1)s[e].c();B(n,"class","sidebar"),B(t,"class","outer-sidebar")},m(e,i){j(e,t,i),G(t,n),c&&c.m(n,null),G(n,o);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(n,null);r=!0},p(e,[t]){e[1]?c||(c=ot(),c.c(),c.m(n,o)):c&&(c.d(1),c=null),1&t&&(l=e[0],fe(),s=function(e,t,n,o,r,s,i,c,l,a,u,d){let p=e.length,f=s.length,m=p;const h={};for(;m--;)h[e[m].key]=m;const g=[],w=new Map,v=new Map,$=[];for(m=f;m--;){const e=d(r,s,m),c=n(e);let l=i.get(c);l?o&&$.push((()=>l.p(e,t))):(l=a(c,e),l.c()),w.set(c,g[m]=l),c in h&&v.set(c,Math.abs(m-h[c]))}const b=new Set,y=new Set;function x(e){he(e,1),e.m(c,u),i.set(e.key,e),u=e.first,f--}for(;p&&f;){const t=g[f-1],n=e[p-1],o=t.key,r=n.key;t===n?(u=t.first,p--,f--):w.has(r)?!i.has(o)||b.has(o)?x(t):y.has(r)?p--:v.get(o)>v.get(r)?(y.add(o),x(t)):(b.add(r),p--):(l(n,i),p--)}for(;p--;){const t=e[p];w.has(t.key)||l(t,i)}for(;f;)x(g[f-1]);return E($),g}(s,t,a,1,e,l,i,n,we,rt,null,nt),me())},i(e){if(!r){for(let e=0;e<l.length;e+=1)he(s[e]);r=!0}},o(e){for(let e=0;e<s.length;e+=1)ge(s[e]);r=!1},d(e){e&&O(t),c&&c.d();for(let e=0;e<s.length;e+=1)s[e].d()}}}function it(e,t,n){let{courses:o}=t,{loadingCourses:r}=t;return e.$$set=e=>{"courses"in e&&n(0,o=e.courses),"loadingCourses"in e&&n(1,r=e.loadingCourses)},[o,r,function(t){W.call(this,e,t)},function(t){W.call(this,e,t)},function(t){W.call(this,e,t)}]}const ct=class extends ke{constructor(e){super(),xe(this,e,it,st,L,{courses:0,loadingCourses:1})}};function lt(e){let t,n;return t=new Ae({props:{selected:e[2]}}),t.$on("input",e[5]),{c(){$e(t.$$.fragment)},m(e,o){be(t,e,o),n=!0},p(e,n){const o={};4&n&&(o.selected=e[2]),t.$set(o)},i(e){n||(he(t.$$.fragment,e),n=!0)},o(e){ge(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function at(e){let t,n;return t=new ze({}),t.$on("login",e[4]),{c(){$e(t.$$.fragment)},m(e,o){be(t,e,o),n=!0},p:_,i(e){n||(he(t.$$.fragment,e),n=!0)},o(e){ge(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function ut(e){let t,n,o,r,s,i,c,l;r=new ct({props:{courses:e[0],loadingCourses:e[1]}}),r.$on("toggle",e[6]),r.$on("select",e[7]),r.$on("reset",e[8]);const a=[at,lt],u=[];function d(e,t){return e[3]?0:1}return i=d(e),c=u[i]=a[i](e),{c(){t=I("link"),n=z(),o=I("div"),$e(r.$$.fragment),s=z(),c.c(),B(t,"rel","shortcut icon"),B(t,"href","/theme/image.php/classic/theme/1588340020/favicon"),document.title="Clean Moodle Setup",B(o,"class","container")},m(e,c){G(document.head,t),j(e,n,c),j(e,o,c),be(r,o,null),G(o,s),u[i].m(o,null),l=!0},p(e,[t]){const n={};1&t&&(n.courses=e[0]),2&t&&(n.loadingCourses=e[1]),r.$set(n);let s=i;i=d(e),i===s?u[i].p(e,t):(fe(),ge(u[s],1,1,(()=>{u[s]=null})),me(),c=u[i],c?c.p(e,t):(c=u[i]=a[i](e),c.c()),he(c,1),c.m(o,null))},i(e){l||(he(r.$$.fragment,e),he(c),l=!0)},o(e){ge(r.$$.fragment,e),ge(c),l=!1},d(e){O(t),e&&O(n),e&&O(o),ye(r),u[i].d()}}}function dt(e,t,n){let o,r=[],s=!0,i=!1;const c=new k;async function l(){let e;try{e=await c.getCourses()}catch{return void a()}const t=[];for(const{id:n,name:o}of e)t.push({courseName:o,courseId:n,value:je(n)});Ye(t),n(0,r=t),n(1,s=!1)}function a(){c.logout(),n(3,i=!0)}function u(e,t){n(0,r=r.map((n=>n.courseId===e?t(n):n))),n(0,r=Ye(r))}return c.login().then(l,a),[r,s,o,i,async function(e){const t=e.detail.username.trim(),{password:o}=e.detail;if(t&&o)try{await c.login({username:t,password:o}),n(3,i=!1),l()}catch{a()}},function(e){const t=o.courseId,r=e.detail.trim();u(t,(e=>e.courseName===r||""===r?(Ie(t),{...e,value:void 0}):(Oe(t,r),{...e,value:r}))),n(2,o=void 0)},function(e){const t=e.detail;o?.courseId===t&&n(2,o=void 0),u(t,(e=>(!1===e.value?Ie(t):Oe(t,!1),{...e,value:!1===e.value&&void 0})))},function(e){n(2,o=e.detail)},function(e){u(e.detail,(e=>({...e,value:void 0}))),Ie(e.detail)}]}const pt=class extends ke{constructor(e){super(),xe(this,e,dt,ut,L,{})}},ft=()=>{const{head:e,body:t}=document;t.replaceChildren(),e.replaceChildren(),history.replaceState({},"","/cleanMoodle"),GM_addStyle('*,::after,::before{box-sizing:border-box}blockquote,body,dd,dl,figure,h1,h2,h3,h4,p{margin:0}ol[role=list],ul[role=list]{list-style:none}html:focus-within{scroll-behavior:smooth}body{min-height:100vh;text-rendering:optimizeSpeed;line-height:1.5;padding:1%}a:not([class]){text-decoration-skip-ink:auto}img,picture{max-width:100%;display:block}button,input,select,textarea{font:inherit}@media (prefers-reduced-motion:reduce){html:focus-within{scroll-behavior:auto}*,::after,::before{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}html{background:#202020;color:#ccc;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:.9375rem;font-weight:400;line-height:1.5;user-select:none}@media (min-width:0px){:root{--sidebar-flex: 0 0 100%;--main-flex: 0 0 100%;--padding-horizontal: 0;--padding-vertical: 0.5%}}@media (min-width:768px){:root{--sidebar-flex: 0 0 32%;--main-flex: 0 0 68%;--padding-horizontal: 0.5%;--padding-vertical: 0}}@media (min-width:992px){:root{--sidebar-flex: 0 0 25%;--main-flex: 0 0 75%}}@media (min-width:1200px){:root{--sidebar-flex: 0 0 20%;--main-flex: 0 0 80%}}.outer-sidebar{flex:var(--sidebar-flex);padding-right:var(--padding-horizontal);padding-bottom:var(--padding-vertical)}.outer-sidebar .sidebar{display:flex;flex-direction:column;padding:10px 15px;border:1.5px solid #343434;border-radius:4px;background-color:#141414}.outer-sidebar .row{cursor:pointer;display:flex;align-items:flex-start;color:#198754}.outer-sidebar .row:hover{text-decoration:underline}.outer-sidebar .row.removed{color:#dc3545}.btn-save:not([disabled]){cursor:pointer}.icon{height:1.5em;width:1.5em}.section-title{font-size:30px;font-weight:300;-webkit-font-smoothing:antialiased}.svg-icon-check{color:#198754}.svg-icon-x{color:#dc3545}.outer-main{flex:var(--main-flex);padding-left:var(--padding-horizontal);padding-top:var(--padding-vertical)}.main{padding:3% 2% 5%;border:1.5px solid #343434;border-radius:4px;background-color:#141414}.replace-flex-inputs{display:flex;flex-direction:column;gap:10px;margin-top:10px}.replace-flex-inputs *{align-self:flex-start}button,input{display:flex;align-items:center;padding:.375rem .75rem;font-size:.9375rem;font-weight:400;line-height:1.5;color:#495057;white-space:nowrap;background-color:#e9ecef;border:1px solid #8f959e;border-radius:.25rem;font-family:inherit}button{text-align:center;background-color:#1177d1;color:#ccc;margin-top:10px}.container{display:flex;flex-direction:row;flex-wrap:wrap;width:100%;height:max-content}'),new pt({target:t})};
// ==UserScript==
// @name      Clean Moodle
// @version   4.0.0
// @author    lusc
// @match     *://moodle.*/*
// @match     *://moodle*.*/*
// @updateURL https://github.com/melusc/moodle_userscripts/raw/userscript-out/Clean%20Moodle/clean-moodle.user.js
// @grant     GM_setValue
// @grant     GM_getValue
// @grant     GM_deleteValue
// @grant     GM_addStyle
// @grant     GM_registerMenuCommand
// @grant     GM_addValueChangeListener
// @run-at    document-start
// @license   MIT
// ==/UserScript==
k.extend((e=>{e.prototype.getCourses=v,e.extend(g)})).extend((e=>{e.prototype.popupLogin=Me})),(e=>{try{(e=>{const t=GM_getValue(s),o=void 0===t?[-1,-1,-1]:n(t),i=Object.entries(e).map((([e,t])=>[n(e),t])).sort((([e],[t])=>r(e,t)));for(const[e,t]of i)r(o,e)<0&&t();GM_setValue(s,GM_info.script.version)})(e)}catch(e){console.error("Upgrading threw %o. Failing silently.",e)}})({"1.4.0":()=>{GM_deleteValue("lastValidatedToken"),GM_deleteValue("password")},"1.5.0"(){const e=GM_getValue("remove")??[],t=GM_getValue("replace")??{};for(const n of e)t[n]=!1;GM_setValue("overrides",t),GM_deleteValue("remove"),GM_deleteValue("replace")}}),"https:"!==location.protocol&&(location.protocol="https:");const mt=new k,ht=!/^\/cleanmoodle/i.test(location.pathname);let gt;const wt=()=>{const n=e();if(!n)return;const o=[...n.querySelectorAll(":scope > li.type_course")];o.sort(((e,n)=>{const o=e.firstElementChild?.textContent,r=n.firstElementChild?.textContent;if(!o||!r)throw new Error("aText or bText was undefined");return t.compare(o.trim(),r.trim())})),n.prepend(...o)},vt=(t,n)=>{const o=(t=>e()?.querySelector(`a[href$="/course/view.php?id=${t}"]`))(t);o?(((e,t)=>{const n=e.closest("li.type_course"),o=n?.classList;o&&!o.contains("current_branch")&&(o.toggle("hide",!t),o.toggle("hidden",!t))})(o,!1!==n),((e,t)=>{const n=t??e.title,o=e.lastChild;o?.nodeType===Node.TEXT_NODE&&(o.textContent=n)})(o,"string"==typeof n?n:void 0)):(async e=>{let t;gt&&await gt;try{t=await mt.getCourses()}catch{await(gt=mt.popupLogin("Clean Moodle")),t=await mt.getCourses()}t.some((t=>String(t.id)===e))||(Ie(e),alert(`You appear to not be in the course with the id "${e}" anymore.\nThe course will not be checked for anymore`))})(t)},$t=()=>{if(!e())return;const t=Ge();for(const[e,n]of Object.entries(t))vt(e,n);wt()},bt=()=>{const t=e();if(GM_registerMenuCommand("Open settings",(()=>{open("/cleanMoodle")})),t){$t(),GM_addValueChangeListener("overrides",((e,t,n,o)=>{if(o)if(t){for(const e of Object.keys(t))e in n||vt(e,void 0);for(const[e,o]of Object.entries(n))o!==t[e]&&vt(e,o);wt()}else $t()}));const e=t.previousSibling;if(e instanceof HTMLParagraphElement){const t=document.createElement("span");e.append(t),new Ne({target:t})}}};if(!/^\/customicons/i.test(location.pathname)){yt=ht?bt:ft,"interactive"!==document.readyState&&"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",yt,{once:!0}):yt()}var yt})();